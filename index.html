<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–í–æ–ª–∫ –ª–æ–≤–∏—Ç —è–π—Ü–∞ ‚Äî Pavel Game Studio</title>
<meta name="description" content="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–æ–≤–µ—Ç—Å–∫–∞—è –∞—Ä–∫–∞–¥–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ">
<meta property="og:title" content="–í–æ–ª–∫ –ª–æ–≤–∏—Ç —è–π—Ü–∞ ‚Äî Pavel Game Studio">
<meta property="og:description" content="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–æ–≤–µ—Ç—Å–∫–∞—è –∞—Ä–∫–∞–¥–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%23073684'/><text x='16' y='23' font-family='Arial' font-size='20' font-weight='bold' fill='white' text-anchor='middle'>P</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  
  :root {
    --dark: #073684;
    --blue: #00629A;
    --lightblue: #B4D5E8;
    --violet: #6B3FA0;
    --lightviolet: #9B7FCC;
    --bg: linear-gradient(135deg, #073684 0%, #0D1B3E 60%, #1a0a3e 100%);
    --error: #FF6B6B;
    --success: #4ECDC4;
  }

  html, body {
    height: 100%;
    overflow: hidden;
    font-family: 'Exo 2', sans-serif;
    background: var(--bg);
    color: #fff;
    user-select: none;
    -webkit-user-select: none;
  }

  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    overflow-y: auto;
    overflow-x: hidden;
    background: linear-gradient(135deg, #073684 0%, #0D1B3E 60%, #1a0a3e 100%);
    background-attachment: fixed;
  }

  /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã –Ω–∞ —Ñ–æ–Ω–µ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(107,63,160,0.15) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(0,98,154,0.15) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
    animation: bgPulse 8s ease-in-out infinite alternate;
  }

  @keyframes bgPulse {
    0% { opacity: 0.6; }
    100% { opacity: 1; }
  }

  /* === –õ–û–ì–û–¢–ò–ü === */
  .logo {
    position: relative;
    z-index: 1;
    text-align: center;
    padding: 20px 0 8px;
    animation: logoGlow 3s ease-in-out infinite alternate;
  }

  @keyframes logoGlow {
    0% { filter: drop-shadow(0 0 8px rgba(155,127,204,0.4)); }
    100% { filter: drop-shadow(0 0 20px rgba(155,127,204,0.9)); }
  }

  .logo-text {
    font-family: 'Orbitron', sans-serif;
    font-weight: 900;
    font-size: 2.5rem;
    background: linear-gradient(90deg, #B4D5E8, #9B7FCC);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: 0.1em;
  }

  .logo-sub {
    font-size: 0.7rem;
    letter-spacing: 0.35em;
    color: #9B7FCC;
    text-transform: uppercase;
    margin-top: 2px;
  }

  .logo-line {
    height: 2px;
    background: linear-gradient(90deg, transparent, #00629A, #6B3FA0, transparent);
    margin: 6px auto 0;
    width: 200px;
    border-radius: 1px;
  }

  /* === –≠–ö–†–ê–ù–´ === */
  .screen {
    display: none;
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 580px;
    padding: 0 16px 20px;
    animation: fadeSlideUp 0.5s ease both;
  }

  .screen.active { display: block; }

  @keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(24px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* === –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ === */
  .menu-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.9rem;
    font-weight: 900;
    text-align: center;
    margin: 10px 0 4px;
    text-shadow: 0 0 20px rgba(180,213,232,0.6), 0 0 40px rgba(107,63,160,0.4);
    animation: titleGlow 2.5s ease-in-out infinite alternate;
  }

  @keyframes titleGlow {
    0% { text-shadow: 0 0 12px rgba(180,213,232,0.4); }
    100% { text-shadow: 0 0 28px rgba(180,213,232,0.9), 0 0 50px rgba(107,63,160,0.6); }
  }

  .menu-subtitle {
    text-align: center;
    color: #B4D5E8;
    font-size: 0.9rem;
    margin-bottom: 24px;
    letter-spacing: 0.1em;
  }

  .btn {
    display: block;
    width: 100%;
    padding: 14px 24px;
    border: none;
    border-radius: 12px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-bottom: 12px;
    letter-spacing: 0.05em;
    position: relative;
    overflow: hidden;
  }

  .btn::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.1);
    opacity: 0;
    transition: opacity 0.2s;
  }

  .btn:hover::after { opacity: 1; }
  .btn:hover { transform: scale(1.04); }
  .btn:active { transform: scale(0.97); }

  .btn-primary {
    background: linear-gradient(135deg, #00629A, #004d78);
    color: #fff;
    box-shadow: 0 4px 20px rgba(0,98,154,0.5);
  }

  .btn-primary:hover {
    box-shadow: 0 6px 28px rgba(0,98,154,0.8);
  }

  .btn-violet {
    background: linear-gradient(135deg, #6B3FA0, #4a2880);
    color: #fff;
    box-shadow: 0 4px 20px rgba(107,63,160,0.5);
  }

  .btn-violet:hover {
    box-shadow: 0 6px 28px rgba(107,63,160,0.8);
  }

  .btn-sm {
    padding: 10px 20px;
    font-size: 0.85rem;
    margin-bottom: 10px;
  }

  .btn-danger {
    background: linear-gradient(135deg, #8B2020, #6b1818);
    color: #fff;
    box-shadow: 0 4px 16px rgba(139,32,32,0.4);
  }

  .panel {
    background: rgba(7,54,132,0.3);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(180,213,232,0.15);
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 14px;
  }

  .highscore-panel {
    text-align: center;
    font-family: 'Orbitron', sans-serif;
  }

  .highscore-label {
    font-size: 0.75rem;
    color: #9B7FCC;
    letter-spacing: 0.2em;
    text-transform: uppercase;
  }

  .highscore-value {
    font-size: 2rem;
    font-weight: 700;
    color: #B4D5E8;
    margin-top: 4px;
  }

  .controls-panel h3 {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.8rem;
    color: #9B7FCC;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .controls-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .ctrl-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.85rem;
    color: #B4D5E8;
  }

  .key {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: rgba(0,98,154,0.4);
    border: 1px solid rgba(180,213,232,0.3);
    border-radius: 6px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.8rem;
    font-weight: 700;
    color: #fff;
    flex-shrink: 0;
  }

  .footer {
    text-align: center;
    color: rgba(180,213,232,0.4);
    font-size: 0.75rem;
    margin-top: 12px;
  }

  /* === –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù === */
  #screen-game {
    padding: 0;
    max-width: 580px;
  }

  .game-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 16px;
    background: rgba(7,54,132,0.5);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid rgba(180,213,232,0.1);
  }

  .score-block {
    font-family: 'Orbitron', sans-serif;
  }

  .score-label {
    font-size: 0.6rem;
    color: #9B7FCC;
    letter-spacing: 0.2em;
    text-transform: uppercase;
  }

  .score-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: #4ECDC4;
    line-height: 1;
    transition: transform 0.15s;
  }

  .score-value.bounce {
    animation: scoreBounce 0.3s ease;
  }

  @keyframes scoreBounce {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); color: #fff; }
    100% { transform: scale(1); }
  }

  .mode-badge {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.7rem;
    padding: 4px 10px;
    border-radius: 6px;
    background: rgba(107,63,160,0.3);
    border: 1px solid rgba(155,127,204,0.3);
    color: #9B7FCC;
    letter-spacing: 0.1em;
  }

  .lives-block {
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .life-icon {
    font-size: 1.4rem;
    transition: all 0.3s;
  }

  .life-icon.lost {
    filter: grayscale(1) opacity(0.3);
    transform: scale(0.8);
  }

  .sound-btn {
    background: none;
    border: 1px solid rgba(180,213,232,0.2);
    border-radius: 8px;
    color: #B4D5E8;
    cursor: pointer;
    padding: 4px 8px;
    font-size: 1rem;
    transition: all 0.2s;
  }

  .sound-btn:hover {
    background: rgba(180,213,232,0.1);
    border-color: rgba(180,213,232,0.4);
  }

  /* === –ò–ì–†–û–í–û–ï –ü–û–õ–ï === */
  #game-field {
    position: relative;
    width: 100%;
    background: #0a2060;
    overflow: hidden;
    border-left: 1px solid rgba(180,213,232,0.1);
    border-right: 1px solid rgba(180,213,232,0.1);
  }

  /* –°–µ—Ç–∫–∞ –ø–æ–ª—è */
  .field-inner {
    position: relative;
    width: 100%;
    height: 100%;
  }

  /* –ö—É—Ä–∏—Ü—ã */
  .chicken {
    position: absolute;
    font-size: 2rem;
    transition: transform 0.2s;
    z-index: 10;
    filter: drop-shadow(0 2px 8px rgba(0,0,0,0.5));
  }

  .chicken.lay {
    animation: chickenLay 0.4s ease;
  }

  @keyframes chickenLay {
    0% { transform: scale(1) rotate(0deg); }
    30% { transform: scale(1.3) rotate(-15deg); }
    70% { transform: scale(1.1) rotate(10deg); }
    100% { transform: scale(1) rotate(0deg); }
  }

  /* –ñ—ë–ª–æ–±–∞ */
  .lane {
    position: absolute;
    background: rgba(0,98,154,0.25);
    border: 1px solid rgba(0,98,154,0.5);
    border-radius: 3px;
    transform-origin: top center;
  }

  /* –Ø–π—Ü–∞ */
  .egg {
    position: absolute;
    font-size: 1.5rem;
    z-index: 20;
    transition: left 0.4s ease, top 0.4s ease;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
    pointer-events: none;
  }

  .egg.caught {
    animation: eggCaught 0.4s ease forwards;
  }

  @keyframes eggCaught {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.6); opacity: 0.8; }
    100% { transform: scale(0); opacity: 0; }
  }

  .egg.broken {
    animation: eggBroken 0.5s ease forwards;
  }

  @keyframes eggBroken {
    0% { transform: scale(1) rotate(0deg); }
    30% { transform: scale(1.3) rotate(20deg); content: 'üí•'; }
    100% { transform: scale(0.5) rotate(45deg); opacity: 0; }
  }

  /* –í–æ–ª–∫ */
  #wolf {
    position: absolute;
    z-index: 30;
    text-align: center;
    transition: left 0.15s ease, top 0.15s ease;
    pointer-events: none;
  }

  .wolf-emoji {
    font-size: 2.2rem;
    display: block;
    filter: drop-shadow(0 2px 8px rgba(0,0,0,0.6));
  }

  .wolf-basket {
    font-size: 1.2rem;
    display: block;
    margin-top: -4px;
  }

  /* –†–∞–∑–±–∏—Ç–æ–µ —è–π—Ü–æ –Ω–∞ –ø–æ–ª—É */
  .splat {
    position: absolute;
    font-size: 1.2rem;
    z-index: 15;
    animation: splatAnim 0.8s ease forwards;
    pointer-events: none;
  }

  @keyframes splatAnim {
    0% { transform: scale(0.5); opacity: 1; }
    40% { transform: scale(1.4); opacity: 1; }
    100% { transform: scale(1); opacity: 0; }
  }

  /* === –ù–ò–ñ–ù–ò–ï –ö–ù–û–ü–ö–ò === */
  .game-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 16px;
    background: rgba(7,54,132,0.5);
    backdrop-filter: blur(8px);
    border-top: 1px solid rgba(180,213,232,0.1);
    gap: 8px;
  }

  .ctrl-group {
    display: flex;
    gap: 6px;
  }

  .game-btn {
    min-width: 54px;
    min-height: 54px;
    border: none;
    border-radius: 10px;
    font-size: 0.8rem;
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    line-height: 1.2;
    letter-spacing: 0.05em;
    padding: 6px 10px;
    color: white;
    position: relative;
    overflow: hidden;
  }

  .game-btn:active { transform: scale(0.9); }

  .game-btn-tl {
    background: linear-gradient(135deg, #00629A, #003f6b);
    box-shadow: 0 3px 12px rgba(0,98,154,0.4);
  }

  .game-btn-bl {
    background: linear-gradient(135deg, #1a4d8a, #0d3060);
    box-shadow: 0 3px 12px rgba(26,77,138,0.4);
  }

  .game-btn-tr {
    background: linear-gradient(135deg, #6B3FA0, #4a2880);
    box-shadow: 0 3px 12px rgba(107,63,160,0.4);
  }

  .game-btn-br {
    background: linear-gradient(135deg, #4a2a7a, #30185a);
    box-shadow: 0 3px 12px rgba(74,42,122,0.4);
  }

  .game-btn-key {
    font-size: 1rem;
    font-weight: 900;
  }

  .game-btn-hint {
    font-size: 0.55rem;
    opacity: 0.7;
    font-family: 'Exo 2', sans-serif;
    font-weight: 400;
    margin-top: 2px;
  }

  .pause-btn {
    background: rgba(180,213,232,0.1);
    border: 1px solid rgba(180,213,232,0.2);
    border-radius: 10px;
    color: #B4D5E8;
    cursor: pointer;
    padding: 10px 14px;
    font-size: 1.2rem;
    transition: all 0.2s;
    min-height: 54px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .pause-btn:hover {
    background: rgba(180,213,232,0.2);
  }

  /* === –û–í–ï–†–õ–ï–ò === */
  .overlay {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(7,27,62,0.85);
    backdrop-filter: blur(8px);
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal {
    background: rgba(7,54,132,0.6);
    border: 1px solid rgba(180,213,232,0.2);
    border-radius: 20px;
    padding: 32px 28px;
    text-align: center;
    max-width: 360px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 40px rgba(107,63,160,0.2);
    animation: modalIn 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }

  @keyframes modalIn {
    from { transform: scale(0.8) translateY(20px); opacity: 0; }
    to { transform: scale(1) translateY(0); opacity: 1; }
  }

  .modal-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.6rem;
    font-weight: 900;
    margin-bottom: 20px;
    color: #FF6B6B;
  }

  .modal-score-label {
    font-size: 0.75rem;
    color: #9B7FCC;
    letter-spacing: 0.2em;
    text-transform: uppercase;
  }

  .modal-score {
    font-family: 'Orbitron', sans-serif;
    font-size: 3rem;
    font-weight: 700;
    color: #4ECDC4;
    margin: 8px 0;
    animation: countUp 0.6s ease;
  }

  @keyframes countUp {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .new-record {
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    color: #FFD700;
    margin-bottom: 12px;
    animation: newRecord 0.5s 0.3s both;
    text-shadow: 0 0 20px rgba(255,215,0,0.6);
  }

  @keyframes newRecord {
    from { transform: scale(0); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .modal-highscore {
    font-size: 0.9rem;
    color: #B4D5E8;
    margin-bottom: 20px;
  }

  .pause-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 2rem;
    font-weight: 900;
    color: #B4D5E8;
    margin-bottom: 24px;
  }

  /* === –ê–ù–ò–ú–ê–¶–ò–ò === */
  .shake {
    animation: shake 0.35s ease;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    15% { transform: translateX(-10px); }
    30% { transform: translateX(10px); }
    45% { transform: translateX(-8px); }
    60% { transform: translateX(8px); }
    75% { transform: translateX(-4px); }
    90% { transform: translateX(4px); }
  }

  .flash-red {
    animation: flashRed 0.4s ease;
  }

  @keyframes flashRed {
    0%, 100% { box-shadow: none; }
    50% { box-shadow: inset 0 0 40px rgba(255,107,107,0.4), 0 0 40px rgba(255,107,107,0.2); }
  }

  /* –ü–∞—Å—Ö–∞–ª–∫–∞ */
  .easter-msg {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Orbitron', sans-serif;
    font-size: 2rem;
    font-weight: 900;
    color: #FFD700;
    text-shadow: 0 0 30px rgba(255,215,0,0.8);
    z-index: 200;
    animation: easterPop 2s ease forwards;
    pointer-events: none;
  }

  @keyframes easterPop {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    70% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -70%) scale(0.8); opacity: 0; }
  }

  /* –°—Ç–∏–ª—å –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .game-btn.active-pos {
    filter: brightness(1.4);
    box-shadow: 0 0 20px rgba(78,205,196,0.6);
  }

  /* –û—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å */
  @media (max-width: 480px) {
    .logo-text { font-size: 1.8rem; }
    .menu-title { font-size: 1.4rem; }
    .game-btn { min-width: 48px; min-height: 48px; font-size: 0.7rem; }
    .wolf-emoji { font-size: 1.8rem; }
    .chicken { font-size: 1.6rem; }
  }
</style>
</head>
<body>

<!-- –õ–æ–≥–æ—Ç–∏–ø -->
<div class="logo">
  <div class="logo-text">Pavel</div>
  <div class="logo-sub">Game Studio</div>
  <div class="logo-line"></div>
</div>

<!-- –≠–ö–†–ê–ù –ú–ï–ù–Æ -->
<div id="screen-menu" class="screen active">
  <div class="menu-title">ü•ö –í–û–õ–ö –õ–û–í–ò–¢ –Ø–ô–¶–ê</div>
  <div class="menu-subtitle">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∞—Ä–∫–∞–¥–∞</div>

  <button class="btn btn-primary" onclick="Game.start('A')">üéÆ –ò–≥—Ä–∞ A ‚Äî –ù–æ—Ä–º–∞–ª—å–Ω–æ</button>
  <button class="btn btn-violet" onclick="Game.start('B')">‚ö° –ò–≥—Ä–∞ B ‚Äî –°–ª–æ–∂–Ω–æ</button>

  <div class="panel highscore-panel">
    <div class="highscore-label">üèÜ –†–µ–∫–æ—Ä–¥</div>
    <div class="highscore-value" id="menu-highscore">000</div>
  </div>

  <div class="panel controls-panel">
    <h3>‚å® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
    <div class="controls-grid">
      <div class="ctrl-item"><span class="key">Q</span> –õ–µ–≤–æ-–≤–µ—Ä—Ö</div>
      <div class="ctrl-item"><span class="key">P</span> –ü—Ä–∞–≤–æ-–≤–µ—Ä—Ö</div>
      <div class="ctrl-item"><span class="key">A</span> –õ–µ–≤–æ-–Ω–∏–∑</div>
      <div class="ctrl-item"><span class="key">L</span> –ü—Ä–∞–≤–æ-–Ω–∏–∑</div>
    </div>
  </div>

  <div class="footer">¬© 2025 Pavel Game Studio</div>
</div>

<!-- –≠–ö–†–ê–ù –ò–ì–†–´ -->
<div id="screen-game" class="screen">
  <!-- –®–∞–ø–∫–∞ -->
  <div class="game-header">
    <div class="score-block">
      <div class="score-label">–°—á—ë—Ç</div>
      <div class="score-value" id="score-display">000</div>
    </div>
    <div style="display:flex; align-items:center; gap:10px;">
      <span class="mode-badge" id="mode-display">A</span>
      <button class="sound-btn" id="sound-toggle" onclick="Sound.toggle()">üîä</button>
    </div>
    <div class="lives-block" id="lives-display">
      <span class="life-icon" id="life-0">ü•ö</span>
      <span class="life-icon" id="life-1">ü•ö</span>
      <span class="life-icon" id="life-2">ü•ö</span>
    </div>
  </div>

  <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
  <div id="game-field">
    <div class="field-inner" id="field-inner">
      <!-- –ñ—ë–ª–æ–±–∞ (—Å–æ–∑–¥–∞—é—Ç—Å—è JS) -->
      <!-- –ö—É—Ä–∏—Ü—ã -->
      <div class="chicken" id="chicken-0">üêî</div>
      <div class="chicken" id="chicken-1">üêî</div>
      <div class="chicken" id="chicken-2">üêî</div>
      <div class="chicken" id="chicken-3">üêî</div>
      <!-- –í–æ–ª–∫ -->
      <div id="wolf">
        <span class="wolf-emoji">üê∫</span>
        <span class="wolf-basket">üß∫</span>
      </div>
    </div>
  </div>

  <!-- –ù–∏–∂–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ -->
  <div class="game-controls">
    <div class="ctrl-group">
      <button class="game-btn game-btn-tl" id="btn-tl" ontouchstart="Wolf.moveTo(0); return false;" onclick="Wolf.moveTo(0)">
        <span class="game-btn-key">Q</span>
        <span class="game-btn-hint">–õ–µ–≤–æ-–≤–µ—Ä—Ö</span>
      </button>
      <button class="game-btn game-btn-bl" id="btn-bl" ontouchstart="Wolf.moveTo(1); return false;" onclick="Wolf.moveTo(1)">
        <span class="game-btn-key">A</span>
        <span class="game-btn-hint">–õ–µ–≤–æ-–Ω–∏–∑</span>
      </button>
    </div>
    <button class="pause-btn" onclick="Game.pause()">‚è∏</button>
    <div class="ctrl-group">
      <button class="game-btn game-btn-tr" id="btn-tr" ontouchstart="Wolf.moveTo(2); return false;" onclick="Wolf.moveTo(2)">
        <span class="game-btn-key">P</span>
        <span class="game-btn-hint">–ü—Ä–∞–≤–æ-–≤–µ—Ä—Ö</span>
      </button>
      <button class="game-btn game-btn-br" id="btn-br" ontouchstart="Wolf.moveTo(3); return false;" onclick="Wolf.moveTo(3)">
        <span class="game-btn-key">L</span>
        <span class="game-btn-hint">–ü—Ä–∞–≤–æ-–Ω–∏–∑</span>
      </button>
    </div>
  </div>
</div>

<!-- –û–í–ï–†–õ–ï–ô –ü–ê–£–ó–´ -->
<div id="overlay-pause" class="overlay" style="display:none;">
  <div class="modal">
    <div class="pause-title">‚è∏ –ü–ê–£–ó–ê</div>
    <button class="btn btn-primary" onclick="Game.resume()">‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    <button class="btn btn-danger" onclick="Game.toMenu()">üè† –í—ã—Ö–æ–¥ –≤ –º–µ–Ω—é</button>
  </div>
</div>

<!-- –û–í–ï–†–õ–ï–ô GAME OVER -->
<div id="overlay-gameover" class="overlay" style="display:none;">
  <div class="modal">
    <div class="modal-title">üíÄ –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</div>
    <div class="modal-score-label">–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç</div>
    <div class="modal-score" id="go-score">000</div>
    <div class="new-record" id="go-newrecord" style="display:none">üåü –ù–û–í–´–ô –†–ï–ö–û–†–î!</div>
    <div class="modal-highscore" id="go-highscore">–†–µ–∫–æ—Ä–¥: 000</div>
    <button class="btn btn-primary" onclick="Game.restart()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    <button class="btn btn-violet" onclick="Game.toMenu()">üè† –ú–µ–Ω—é</button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ó–í–£–ö
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Sound = (() => {
  let ctx = null;
  let enabled = true;

  function getCtx() {
    if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
    return ctx;
  }

  function beep(freq, dur, type = 'sine', vol = 0.3, delay = 0) {
    if (!enabled) return;
    try {
      const ac = getCtx();
      const osc = ac.createOscillator();
      const gain = ac.createGain();
      osc.connect(gain);
      gain.connect(ac.destination);
      osc.type = type;
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(vol, ac.currentTime + delay);
      gain.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + delay + dur);
      osc.start(ac.currentTime + delay);
      osc.stop(ac.currentTime + delay + dur + 0.01);
    } catch(e) {}
  }

  function noise(dur, vol = 0.2) {
    if (!enabled) return;
    try {
      const ac = getCtx();
      const buf = ac.createBuffer(1, ac.sampleRate * dur, ac.sampleRate);
      const data = buf.getChannelData(0);
      for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
      const src = ac.createBufferSource();
      src.buffer = buf;
      const gain = ac.createGain();
      src.connect(gain);
      gain.connect(ac.destination);
      gain.gain.setValueAtTime(vol, ac.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + dur);
      src.start();
    } catch(e) {}
  }

  return {
    playCapture() { beep(800, 0.1, 'sine', 0.3); },
    playMiss() { beep(200, 0.3, 'sawtooth', 0.3); },
    playGameOver() {
      beep(440, 0.25, 'sine', 0.3, 0);
      beep(330, 0.25, 'sine', 0.3, 0.28);
      beep(220, 0.5, 'sine', 0.4, 0.56);
    },
    playClick() { noise(0.05, 0.15); },
    playBonus() {
      [523, 659, 784, 1047].forEach((f, i) => beep(f, 0.15, 'sine', 0.25, i * 0.12));
    },
    toggle() {
      enabled = !enabled;
      document.getElementById('sound-toggle').textContent = enabled ? 'üîä' : 'üîá';
    }
  };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –°–ß–Å–¢ –ò –†–ï–ö–û–†–î–´
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Score = (() => {
  let score = 0;
  let misses = 0;
  let highscore = parseInt(localStorage.getItem('wolfHS') || '0');
  let lastBonus = 0; // –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–æ–Ω—É—Å–∞ –∫–∞–∂–¥—ã–µ 100

  function updateUI() {
    const el = document.getElementById('score-display');
    el.textContent = String(score).padStart(3, '0');
    el.classList.remove('bounce');
    void el.offsetWidth;
    el.classList.add('bounce');
    setTimeout(() => el.classList.remove('bounce'), 300);
  }

  function updateLives() {
    for (let i = 0; i < 3; i++) {
      const el = document.getElementById('life-' + i);
      el.classList.toggle('lost', i >= (3 - misses));
    }
  }

  return {
    reset() { score = 0; misses = 0; lastBonus = 0; updateUI(); updateLives(); },
    add() {
      score = Math.min(score + 1, 999);
      updateUI();
      // –ö–∞–∂–¥—ã–µ 100 –æ—á–∫–æ–≤ ‚Äî –±–æ–Ω—É—Å
      const b100 = Math.floor(score / 100);
      if (b100 > lastBonus) {
        lastBonus = b100;
        if (misses > 0) { misses--; updateLives(); }
        Sound.playBonus();
        // –ü–∞—Å—Ö–∞–ª–∫–∏
        const msgs = {1: '–û—Ç–ª–∏—á–Ω–æ! üéâ', 2: '–ú–∞—Å—Ç–µ—Ä! üî•', 5: '–õ–µ–≥–µ–Ω–¥–∞! üëë'};
        if (msgs[b100]) showEaster(msgs[b100]);
      }
      return score;
    },
    addMiss() {
      misses++;
      updateLives();
      return misses;
    },
    get score() { return score; },
    get misses() { return misses; },
    get highscore() { return highscore; },
    saveHighscore() {
      if (score > highscore) {
        highscore = score;
        localStorage.setItem('wolfHS', highscore);
        return true;
      }
      return false;
    },
    updateMenuHS() {
      document.getElementById('menu-highscore').textContent = String(highscore).padStart(3, '0');
    }
  };
})();

function showEaster(msg) {
  const el = document.createElement('div');
  el.className = 'easter-msg';
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 2100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞–º–∏
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const UI = (() => {
  function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    const el = document.getElementById('screen-' + id);
    if (el) { el.classList.add('active'); void el.offsetWidth; }
  }

  return {
    showMenu() {
      show('menu');
      Score.updateMenuHS();
      document.getElementById('overlay-gameover').style.display = 'none';
      document.getElementById('overlay-pause').style.display = 'none';
    },
    showGame() { show('game'); },
    showPause() { document.getElementById('overlay-pause').style.display = 'flex'; },
    hidePause() { document.getElementById('overlay-pause').style.display = 'none'; },
    showGameOver(isNew) {
      const s = Score.score;
      document.getElementById('go-score').textContent = String(s).padStart(3, '0');
      document.getElementById('go-highscore').textContent = '–†–µ–∫–æ—Ä–¥: ' + String(Score.highscore).padStart(3, '0');
      document.getElementById('go-newrecord').style.display = isNew ? 'block' : 'none';
      document.getElementById('overlay-gameover').style.display = 'flex';
    }
  };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –í–û–õ–ö
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Wolf = (() => {
  let pos = 0; // 0=–ª–µ–≤–æ-–≤–µ—Ä—Ö, 1=–ª–µ–≤–æ-–Ω–∏–∑, 2=–ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö, 3=–ø—Ä–∞–≤–æ-–Ω–∏–∑
  const wolfEl = document.getElementById('wolf');
  const btnIds = ['btn-tl', 'btn-bl', 'btn-tr', 'btn-br'];

  function updateBtnHighlight() {
    btnIds.forEach((id, i) => {
      const el = document.getElementById(id);
      if (el) el.classList.toggle('active-pos', i === pos);
    });
  }

  return {
    get pos() { return pos; },
    moveTo(p) {
      pos = p;
      Wolf.render();
      updateBtnHighlight();
      Sound.playClick();
    },
    render() {
      const coords = GameField.getWolfCoords(pos);
      wolfEl.style.left = coords.x + 'px';
      wolfEl.style.top = coords.y + 'px';
    },
    reset() {
      pos = 0;
      Wolf.render();
      updateBtnHighlight();
    }
  };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ò–ì–†–û–í–û–ï –ü–û–õ–ï ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const GameField = (() => {
  let W = 0, H = 0;

  // –ñ—ë–ª–æ–±—ã: 0=–ª–µ–≤–æ-–≤–µ—Ä—Ö, 1=–ª–µ–≤–æ-–Ω–∏–∑, 2=–ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö, 3=–ø—Ä–∞–≤–æ-–Ω–∏–∑
  // –ö–∞–∂–¥—ã–π –∂—ë–ª–æ–± –∏–º–µ–µ—Ç 4 –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —è–π—Ü–∞ (–æ—Ç –∫—É—Ä–∏—Ü—ã –≤–Ω–∏–∑)
  // –ü–æ–∑–∏—Ü–∏—è 3 (–∫–æ–Ω–µ—Ü) ‚Äî —Ç–∞–º –≤–æ–ª–∫ –¥–æ–ª–∂–µ–Ω —Å—Ç–æ—è—Ç—å

  function getSize() {
    const field = document.getElementById('game-field');
    W = field.offsetWidth;
    H = field.offsetHeight;
    return { W, H };
  }

  // –ü–æ–∑–∏—Ü–∏–∏ —è–∏—Ü –Ω–∞ –∫–∞–∂–¥–æ–º –∂—ë–ª–æ–±–µ (4 —Ç–æ—á–∫–∏)
  // lane 0: –ª–µ–≤–æ-–≤–µ—Ä—Ö, lane 1: –ª–µ–≤–æ-–Ω–∏–∑, lane 2: –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö, lane 3: –ø—Ä–∞–≤–æ-–Ω–∏–∑
  function getEggPos(lane, step) {
    const { W, H } = getSize();
    // –ö—É—Ä–∏—Ü—ã –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 15% –æ—Ç –∫—Ä–∞—ë–≤ –∏ 10%/40% –ø–æ –≤—ã—Å–æ—Ç–µ
    // –ö–æ–Ω—Ü—ã –∂—ë–ª–æ–±–æ–≤ ‚Äî –≤ —Ü–µ–Ω—Ç—Ä–µ, —Å–Ω–∏–∑—É
    const cx = W / 2; // —Ü–µ–Ω—Ç—Ä X

    // –ù–∞—á–∞–ª–∞ (—É –∫—É—Ä–∏—Ü—ã) –∏ –∫–æ–Ω—Ü—ã (—É –≤–æ–ª–∫–∞) –∫–∞–∂–¥–æ–≥–æ –∂—ë–ª–æ–±–∞
    const laneData = [
      // lane 0: –ª–µ–≤–æ-–≤–µ—Ä—Ö
      { startX: W * 0.1, startY: H * 0.07, endX: W * 0.18, endY: H * 0.72 },
      // lane 1: –ª–µ–≤–æ-–Ω–∏–∑
      { startX: W * 0.1, startY: H * 0.38, endX: W * 0.22, endY: H * 0.82 },
      // lane 2: –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö
      { startX: W * 0.9, startY: H * 0.07, endX: W * 0.82, endY: H * 0.72 },
      // lane 3: –ø—Ä–∞–≤–æ-–Ω–∏–∑
      { startX: W * 0.9, startY: H * 0.38, endX: W * 0.78, endY: H * 0.82 },
    ];

    const ld = laneData[lane];
    const t = step / 3; // 0..1
    return {
      x: ld.startX + (ld.endX - ld.startX) * t - 12,
      y: ld.startY + (ld.endY - ld.startY) * t - 12,
    };
  }

  function getChickenPos(lane) {
    const { W, H } = getSize();
    const pos = [
      { x: W * 0.04, y: H * 0.02 },
      { x: W * 0.04, y: H * 0.33 },
      { x: W * 0.84, y: H * 0.02 },
      { x: W * 0.84, y: H * 0.33 },
    ];
    return pos[lane];
  }

  function getWolfCoords(pos) {
    const { W, H } = getSize();
    // –í–æ–ª–∫ —Å—Ç–æ–∏—Ç –≤ –∫–æ–Ω—Ü–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∂—ë–ª–æ–±–∞
    const wolfPos = [
      { x: W * 0.10, y: H * 0.68 },  // –ª–µ–≤–æ-–≤–µ—Ä—Ö
      { x: W * 0.10, y: H * 0.78 },  // –ª–µ–≤–æ-–Ω–∏–∑
      { x: W * 0.72, y: H * 0.68 },  // –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö
      { x: W * 0.68, y: H * 0.78 },  // –ø—Ä–∞–≤–æ-–Ω–∏–∑
    ];
    return wolfPos[pos];
  }

  function getLaneSegment(lane) {
    const { W, H } = getSize();
    const laneData = [
      { startX: W * 0.14, startY: H * 0.12, endX: W * 0.22, endY: H * 0.68 },
      { startX: W * 0.14, startY: H * 0.42, endX: W * 0.26, endY: H * 0.78 },
      { startX: W * 0.86, startY: H * 0.12, endX: W * 0.78, endY: H * 0.68 },
      { startX: W * 0.86, startY: H * 0.42, endX: W * 0.74, endY: H * 0.78 },
    ];
    return laneData[lane];
  }

  return { getSize, getEggPos, getChickenPos, getWolfCoords, getLaneSegment };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –Ø–ô–¶–ê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
class Egg {
  constructor(lane) {
    this.lane = lane;
    this.step = 0; // 0..3
    this.active = true;
    this.el = document.createElement('div');
    this.el.className = 'egg';
    this.el.textContent = 'ü•ö';
    document.getElementById('field-inner').appendChild(this.el);
    this.render();
    // –ê–Ω–∏–º–∞—Ü–∏—è –∫—É—Ä–∏—Ü—ã
    const chicken = document.getElementById('chicken-' + lane);
    if (chicken) {
      chicken.classList.add('lay');
      setTimeout(() => chicken.classList.remove('lay'), 400);
    }
  }

  render() {
    const pos = GameField.getEggPos(this.lane, this.step);
    this.el.style.left = pos.x + 'px';
    this.el.style.top = pos.y + 'px';
  }

  advance() {
    this.step++;
    this.render();
  }

  catch() {
    this.active = false;
    this.el.classList.add('caught');
    setTimeout(() => this.el.remove(), 500);
  }

  break() {
    this.active = false;
    this.el.classList.add('broken');
    // –°–æ–∑–¥–∞—Ç—å "—Ä–∞–∑–±–∏—Ç–æ–µ —è–π—Ü–æ"
    const splat = document.createElement('div');
    splat.className = 'splat';
    splat.textContent = 'üí•';
    const pos = GameField.getEggPos(this.lane, this.step);
    splat.style.left = pos.x + 'px';
    splat.style.top = pos.y + 'px';
    document.getElementById('field-inner').appendChild(splat);
    setTimeout(() => { splat.remove(); }, 900);
    setTimeout(() => this.el.remove(), 600);
  }

  destroy() {
    this.active = false;
    if (this.el.parentNode) this.el.remove();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –û–°–ù–û–í–ù–ê–Ø –ò–ì–†–ê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Game = (() => {
  let mode = 'A';
  let eggs = []; // –∞–∫—Ç–∏–≤–Ω—ã–µ —è–π—Ü–∞
  let laneOccupied = [false, false, false, false]; // –∑–∞–Ω—è—Ç –ª–∏ –∂—ë–ª–æ–±
  let spawnInterval = null;
  let moveInterval = null;
  let running = false;
  let paused = false;
  let frameId = null;
  let lastMoveTime = 0;
  let moveDelay = 500; // –º—Å –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ —è–π—Ü–∞
  let spawnDelay = 2000; // –º—Å –º–µ–∂–¥—É –ø–æ—è–≤–ª–µ–Ω–∏–µ–º —è–∏—Ü
  let spawnTimer = 0;
  let lastTime = 0;
  let fieldH = 0;

  function calcSpeed() {
    // –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 50 –æ—á–∫–æ–≤
    const sp = Score.score;
    const factor = Math.pow(0.9, Math.floor(sp / 50));
    const baseMove = mode === 'A' ? 500 : 380;
    const baseSpawn = mode === 'A' ? 2000 : 1400;
    const minMove = mode === 'A' ? 200 : 150;
    const minSpawn = mode === 'A' ? 600 : 400;
    moveDelay = Math.max(minMove, Math.round(baseMove * factor));
    spawnDelay = Math.max(minSpawn, Math.round(baseSpawn * factor));
  }

  function spawnEgg() {
    // –ù–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—ã–π –∂—ë–ª–æ–±
    const free = [0,1,2,3].filter(i => !laneOccupied[i]);
    if (free.length === 0) return;
    const lane = free[Math.floor(Math.random() * free.length)];
    laneOccupied[lane] = true;
    const egg = new Egg(lane);
    eggs.push(egg);
  }

  function moveEggs() {
    for (let i = eggs.length - 1; i >= 0; i--) {
      const egg = eggs[i];
      if (!egg.active) { eggs.splice(i, 1); continue; }
      if (egg.step >= 3) {
        // –î–æ—Å—Ç–∏–≥ –∫–æ–Ω—Ü–∞ –∂—ë–ª–æ–±–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏–º–∫–∏
        if (Wolf.pos === egg.lane) {
          egg.catch();
          Score.add();
          Sound.playCapture();
          calcSpeed();
        } else {
          egg.break();
          const m = Score.addMiss();
          Sound.playMiss();
          // –¢—Ä—è—Å–∫–∞ –ø–æ–ª—è
          const field = document.getElementById('game-field');
          field.classList.add('shake');
          setTimeout(() => field.classList.remove('shake'), 350);
          field.classList.add('flash-red');
          setTimeout(() => field.classList.remove('flash-red'), 400);
          if (m >= 3) {
            laneOccupied[egg.lane] = false;
            eggs.splice(i, 1);
            setTimeout(() => endGame(), 600);
            return;
          }
        }
        laneOccupied[egg.lane] = false;
        eggs.splice(i, 1);
      } else {
        egg.advance();
      }
    }
  }

  function loop(ts) {
    if (!running || paused) return;
    const dt = ts - lastTime;
    lastTime = ts;

    lastMoveTime += dt;
    spawnTimer += dt;

    if (spawnTimer >= spawnDelay) {
      spawnTimer = 0;
      spawnEgg();
    }

    if (lastMoveTime >= moveDelay) {
      lastMoveTime = 0;
      moveEggs();
    }

    if (running && !paused) frameId = requestAnimationFrame(loop);
  }

  function clearEggs() {
    eggs.forEach(e => e.destroy());
    eggs = [];
    laneOccupied = [false, false, false, false];
  }

  function layoutField() {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –ø–æ–ª—è
    const field = document.getElementById('game-field');
    const vh = window.innerHeight;
    const header = document.querySelector('.game-header');
    const controls = document.querySelector('.game-controls');
    const logo = document.querySelector('.logo');
    const hh = header ? header.offsetHeight : 60;
    const ch = controls ? controls.offsetHeight : 70;
    const lh = logo ? logo.offsetHeight : 0;
    const available = vh - hh - ch - lh - 10;
    field.style.height = Math.max(260, Math.min(available, 420)) + 'px';
    fieldH = field.offsetHeight;

    // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä–∏—Ü
    for (let i = 0; i < 4; i++) {
      const c = document.getElementById('chicken-' + i);
      const p = GameField.getChickenPos(i);
      c.style.left = p.x + 'px';
      c.style.top = p.y + 'px';
    }

    // –†–∏—Å—É–µ–º –∂—ë–ª–æ–±–∞
    document.querySelectorAll('.lane').forEach(l => l.remove());
    for (let i = 0; i < 4; i++) {
      drawLane(i);
    }

    Wolf.render();
  }

  function drawLane(lane) {
    const seg = GameField.getLaneSegment(lane);
    const dx = seg.endX - seg.startX;
    const dy = seg.endY - seg.startY;
    const len = Math.sqrt(dx * dx + dy * dy);
    const angle = Math.atan2(dy, dx) * 180 / Math.PI;

    const el = document.createElement('div');
    el.className = 'lane';
    el.style.width = len + 'px';
    el.style.height = '8px';
    el.style.left = seg.startX + 'px';
    el.style.top = seg.startY + 'px';
    el.style.transform = `rotate(${angle}deg)`;
    el.style.transformOrigin = '0 50%';
    document.getElementById('field-inner').appendChild(el);
  }

  function endGame() {
    running = false;
    if (frameId) { cancelAnimationFrame(frameId); frameId = null; }
    clearEggs();
    Sound.playGameOver();
    const isNew = Score.saveHighscore();
    setTimeout(() => UI.showGameOver(isNew), 400);
  }

  return {
    start(m) {
      mode = m;
      Score.reset();
      Wolf.reset();
      document.getElementById('mode-display').textContent = '–†–µ–∂–∏–º ' + m;
      UI.showGame();
      // –ñ–¥—ë–º —Ä–µ–Ω–¥–µ—Ä, –ø–æ—Ç–æ–º —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ–º –ø–æ–ª–µ
      setTimeout(() => {
        layoutField();
        calcSpeed();
        clearEggs();
        running = true;
        paused = false;
        lastMoveTime = 0;
        spawnTimer = spawnDelay * 0.5; // –ø–µ—Ä–≤–æ–µ —è–π—Ü–æ –±—ã—Å—Ç—Ä–µ–µ
        lastTime = performance.now();
        frameId = requestAnimationFrame(loop);
      }, 100);
    },
    restart() {
      document.getElementById('overlay-gameover').style.display = 'none';
      Game.start(mode);
    },
    pause() {
      if (!running) return;
      paused = true;
      if (frameId) { cancelAnimationFrame(frameId); frameId = null; }
      UI.showPause();
    },
    resume() {
      paused = false;
      UI.hidePause();
      lastTime = performance.now();
      frameId = requestAnimationFrame(loop);
    },
    toMenu() {
      running = false;
      paused = false;
      if (frameId) { cancelAnimationFrame(frameId); frameId = null; }
      clearEggs();
      document.getElementById('overlay-gameover').style.display = 'none';
      document.getElementById('overlay-pause').style.display = 'none';
      UI.showMenu();
    }
  };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ö–õ–ê–í–ò–ê–¢–£–†–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('keydown', (e) => {
  if (document.getElementById('screen-game').classList.contains('active')) {
    switch(e.key.toLowerCase()) {
      case 'q': Wolf.moveTo(0); break;
      case 'a': Wolf.moveTo(1); break;
      case 'p': Wolf.moveTo(2); break;
      case 'l': Wolf.moveTo(3); break;
      case 'escape': 
        if (document.getElementById('overlay-pause').style.display === 'flex') {
          Game.resume();
        } else {
          Game.pause();
        }
        break;
    }
    e.preventDefault();
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –†–ï–°–ê–ô–ó
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('resize', () => {
  if (document.getElementById('screen-game').classList.contains('active')) {
    // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å layout
    const field = document.getElementById('game-field');
    const vh = window.innerHeight;
    const header = document.querySelector('.game-header');
    const controls = document.querySelector('.game-controls');
    const logo = document.querySelector('.logo');
    const hh = header ? header.offsetHeight : 60;
    const ch = controls ? controls.offsetHeight : 70;
    const lh = logo ? logo.offsetHeight : 0;
    const available = vh - hh - ch - lh - 10;
    field.style.height = Math.max(260, Math.min(available, 420)) + 'px';

    for (let i = 0; i < 4; i++) {
      const c = document.getElementById('chicken-' + i);
      const p = GameField.getChickenPos(i);
      c.style.left = p.x + 'px';
      c.style.top = p.y + 'px';
    }
    document.querySelectorAll('.lane').forEach(l => l.remove());
    for (let i = 0; i < 4; i++) {
      // drawLane —á–µ—Ä–µ–∑ GameField
      const seg = GameField.getLaneSegment(i);
      const dx = seg.endX - seg.startX;
      const dy = seg.endY - seg.startY;
      const len = Math.sqrt(dx * dx + dy * dy);
      const angle = Math.atan2(dy, dx) * 180 / Math.PI;
      const el = document.createElement('div');
      el.className = 'lane';
      el.style.width = len + 'px';
      el.style.height = '8px';
      el.style.left = seg.startX + 'px';
      el.style.top = seg.startY + 'px';
      el.style.transform = `rotate(${angle}deg)`;
      el.style.transformOrigin = '0 50%';
      document.getElementById('field-inner').appendChild(el);
    }
    Wolf.render();
  }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
Score.updateMenuHS();
</script>
</body>
</html>
