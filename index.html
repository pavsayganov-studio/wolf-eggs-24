<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://api.bitrix24.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;">
<title>–í–æ–ª–∫ –ª–æ–≤–∏—Ç —è–π—Ü–∞ ‚Äî Pavel Game Studio</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%230066A1'/><text x='16' y='23' font-family='Arial' font-size='20' font-weight='bold' fill='%232FC7F7' text-anchor='middle'>P</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<!-- –ë–∏—Ç—Ä–∏–∫—Å24 API -->
<script src="https://api.bitrix24.com/api/v1/"></script>

<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ü–ï–†–ï–ú–ï–ù–ù–´–ï
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --lime:         #D4F01A;
  --lime-hover:   #BFDA10;
  --glass-nav:    rgba(255,255,255,0.18);
  --glass-card:   rgba(255,255,255,0.12);
  --glass-border: rgba(255,255,255,0.25);
  --text-white:   #FFFFFF;
  --text-dim:     rgba(255,255,255,0.70);
  --text-muted:   rgba(255,255,255,0.45);
  --error:        #FF3B5C;
  --black:        #292426;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BASE ‚Äî landscape-first
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  font-family: 'Inter', sans-serif;
  color: var(--text-white);
  -webkit-user-select: none; user-select: none;
  background:
    radial-gradient(ellipse 110% 80% at 50% 0%,   #1e75ff 0%, transparent 65%),
    radial-gradient(ellipse 80%  70% at 100% 60%,  #0e4fd8 0%, transparent 65%),
    radial-gradient(ellipse 70%  55% at 0%   90%,  #0840c0 0%, transparent 55%),
    #1565FF;
  background-attachment: fixed;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ROTATE WARNING (portrait + narrow)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#rotate-warning {
  display: none;
  position: fixed; inset: 0; z-index: 9999;
  background: #0D2847;
  flex-direction: column; align-items: center; justify-content: center; gap: 20px;
  text-align: center; padding: 24px;
}
#rotate-warning .rw-icon { font-size: 4rem; animation: rotAnim 2s ease-in-out infinite; }
@keyframes rotAnim {
  0%,100% { transform: rotate(0deg); }
  40%     { transform: rotate(90deg); }
  60%     { transform: rotate(90deg); }
}
#rotate-warning .rw-title { font-size: 1.3rem; font-weight: 800; color: var(--lime); }
#rotate-warning .rw-sub   { font-size: 0.9rem; color: var(--text-dim); margin-top: 6px; }

@media (orientation: portrait) and (max-width: 650px) {
  #rotate-warning { display: flex; }
  #game-container { display: none !important; }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GAME CONTAINER ‚Äî –≤–µ—Å—å —ç–∫—Ä–∞–Ω
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#game-container {
  width: 100%; height: 100%;
  max-width: 1200px; max-height: 720px;
  margin: 0 auto;
  display: flex; flex-direction: column;
  position: relative;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –≠–ö–†–ê–ù–´
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.screen {
  display: none;
  width: 100%; height: 100%;
  animation: fadeUp 0.35s cubic-bezier(0.22,1,0.36,1) both;
}
.screen.active { display: flex; flex-direction: column; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ú–ï–ù–Æ ‚Äî LANDSCAPE 2-–∫–æ–ª–æ–Ω–∫–∏
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#screen-menu {
  flex-direction: row;
  align-items: stretch;
}

/* –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –º–µ–Ω—é */
.menu-left {
  width: 300px; flex-shrink: 0;
  display: flex; flex-direction: column; justify-content: center;
  padding: 24px 20px 24px 28px;
  border-right: 1px solid var(--glass-border);
  background: rgba(255,255,255,0.05);
}

.menu-logo {
  display: flex; align-items: center; gap: 8px; margin-bottom: 20px;
}
.menu-logo-text {
  font-size: 1.6rem; font-weight: 900; color: var(--text-white); letter-spacing: -0.02em;
}
.logo-dot {
  width: 8px; height: 8px; background: var(--lime); border-radius: 50%;
  animation: dotBlink 2s ease-in-out infinite; flex-shrink: 0;
}
@keyframes dotBlink { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.75)} }

.menu-title {
  font-size: 1.55rem; font-weight: 900; color: var(--text-white);
  letter-spacing: -0.02em; line-height: 1.15; margin-bottom: 6px;
}
.menu-subtitle {
  font-size: 0.82rem; color: var(--text-muted); font-style: italic; margin-bottom: 26px;
}

.menu-hs-row {
  display: flex; align-items: center; gap: 10px;
  background: var(--glass-card); border: 1px solid var(--glass-border);
  border-radius: 12px; padding: 10px 14px; margin-bottom: 20px;
}
.menu-hs-label { font-size: 0.65rem; font-weight: 700; color: var(--text-muted); letter-spacing: 0.2em; text-transform: uppercase; }
.menu-hs-value { font-size: 1.8rem; font-weight: 900; color: var(--lime); line-height: 1; letter-spacing: -0.02em; margin-left: auto; text-shadow: 0 0 16px rgba(212,240,26,0.4); }

/* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –º–µ–Ω—é */
.menu-right {
  flex: 1; display: flex; flex-direction: column;
  justify-content: center; padding: 24px 28px 24px 24px; gap: 16px;
}

/* –ù–∏–∂–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –º–µ–Ω—é */
.menu-footer {
  position: absolute; bottom: 10px; left: 0; right: 0;
  text-align: center; font-size: 0.65rem; color: var(--text-muted);
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
.ctrl-card {
  background: var(--glass-card); backdrop-filter: blur(16px);
  border: 1px solid var(--glass-border); border-radius: 14px; padding: 16px 18px;
  flex: 1;
}
.ctrl-card h3 { font-size: 0.62rem; font-weight: 700; color: var(--text-muted); letter-spacing: 0.2em; text-transform: uppercase; margin-bottom: 12px; }
.ctrl-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
.ctrl-item { display: flex; align-items: center; gap: 8px; font-size: 0.78rem; color: var(--text-dim); }
.key {
  display: inline-flex; align-items: center; justify-content: center;
  width: 28px; height: 28px; background: rgba(255,255,255,0.15);
  border: 1.5px solid rgba(255,255,255,0.35); border-radius: 6px;
  font-size: 0.9rem; font-weight: 800; color: var(--text-white); flex-shrink: 0;
}
.ctrl-note { font-size: 0.7rem; color: var(--text-muted); line-height: 1.65; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ö–ù–û–ü–ö–ò
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.btn {
  border: none; border-radius: 999px;
  font-family: 'Inter', sans-serif; font-weight: 800;
  cursor: pointer; transition: all 0.2s ease;
  position: relative; overflow: hidden;
  letter-spacing: 0.04em; text-transform: uppercase;
}
.btn:active { transform: scale(0.95) !important; }

.btn-lime {
  display: block; width: 100%; padding: 14px 24px; font-size: 0.92rem;
  color: var(--black); background: var(--lime);
  box-shadow: 0 4px 20px rgba(212,240,26,0.35); margin-bottom: 10px;
}
.btn-lime:hover { background: var(--lime-hover); transform: scale(1.03); box-shadow: 0 8px 30px rgba(212,240,26,0.5); }

.btn-glass {
  display: block; width: 100%; padding: 12px 24px; font-size: 0.85rem;
  color: var(--text-white); background: var(--glass-card);
  border: 1.5px solid var(--glass-border); backdrop-filter: blur(12px); margin-bottom: 10px;
}
.btn-glass:hover { background: rgba(255,255,255,0.2); transform: scale(1.02); }

.btn-outline {
  padding: 10px 22px; font-size: 0.82rem;
  color: var(--text-white); background: transparent;
  border: 1.5px solid var(--glass-border);
}
.btn-outline:hover { background: rgba(255,255,255,0.1); transform: scale(1.02); }

.btn-icon {
  padding: 8px 14px; font-size: 0.8rem;
  color: var(--text-white); background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.25); border-radius: 10px;
  display: flex; align-items: center; gap: 5px;
}
.btn-icon:hover { background: rgba(255,255,255,0.22); transform: scale(1.03); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù ‚Äî LANDSCAPE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#screen-game { flex-direction: column; }

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
.game-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 6px 16px;
  background: rgba(8,48,160,0.65);
  backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
  border-bottom: 1px solid rgba(255,255,255,0.12);
  flex-shrink: 0; gap: 12px;
  /* –¢–æ–Ω–∫–∞—è –ª–∞–π–º–æ–≤–∞—è —á–µ—Ä—Ç–∞ —Å–Ω–∏–∑—É */
  box-shadow: 0 1px 0 rgba(212,240,26,0.2), 0 2px 12px rgba(0,0,0,0.2);
}
.game-header-left   { display: flex; align-items: center; gap: 12px; }
.game-header-center { display: flex; align-items: center; gap: 8px; flex: 1; justify-content: center; }
.game-header-right  { display: flex; align-items: center; gap: 8px; }

.score-block { display: flex; align-items: baseline; gap: 6px; }
.score-label { font-size: 0.58rem; font-weight: 700; color: var(--text-muted); letter-spacing: 0.2em; text-transform: uppercase; }
.score-value { font-size: 1.6rem; font-weight: 900; color: var(--lime); line-height: 1; letter-spacing: -0.02em; text-shadow: 0 0 12px rgba(212,240,26,0.4); }
.score-value.bounce { animation: scoreBounce 0.28s ease; }
@keyframes scoreBounce { 0%{transform:scale(1)} 45%{transform:scale(1.3)} 100%{transform:scale(1)} }

.mode-badge {
  font-size: 0.58rem; font-weight: 800; padding: 3px 9px; border-radius: 999px;
  background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.28);
  color: var(--text-white); letter-spacing: 0.08em; text-transform: uppercase;
}
.logo-small { font-size: 0.95rem; font-weight: 900; color: var(--text-white); letter-spacing: -0.01em; display: flex; align-items: center; gap: 4px; }
.logo-small .logo-dot { width: 5px; height: 5px; }

.lives-block { display: flex; gap: 5px; align-items: center; }
.life-icon { font-size: 1.15rem; transition: all 0.3s; filter: drop-shadow(0 0 5px rgba(212,240,26,0.4)); }
.life-icon.lost { filter: grayscale(1) opacity(0.2); transform: scale(0.7); }

.sound-btn {
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.22);
  border-radius: 7px; color: var(--text-white); cursor: pointer;
  padding: 4px 8px; font-size: 0.85rem; transition: all 0.2s; line-height: 1;
}
.sound-btn:hover { background: rgba(255,255,255,0.22); }

/* ‚îÄ‚îÄ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞: D-pad | –ü–û–õ–ï | D-pad ‚îÄ‚îÄ */
.game-main {
  flex: 1; min-height: 0;
  display: flex; flex-direction: row; align-items: stretch;
}

/* D-PAD ‚Äî –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π, –ø–æ –±–æ–∫–∞–º */
.dpad-panel {
  width: 88px; flex-shrink: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 10px 6px;
  background: linear-gradient(180deg, rgba(255,255,255,0.07) 0%, rgba(255,255,255,0.03) 100%);
  border-right: 1px solid rgba(255,255,255,0.08);
  gap: 5px;
}
#dpad-right { border-right: none; border-left: 1px solid rgba(255,255,255,0.08); }

.dpad-label {
  font-size: 0.44rem; font-weight: 800; color: var(--text-muted);
  letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 6px;
}
.dpad-row { display: flex; gap: 4px; }

.dp-btn {
  width: 46px; height: 40px;
  background: rgba(255,255,255,0.1);
  border: 1.5px solid rgba(255,255,255,0.2); border-radius: 10px;
  font-size: 1rem; cursor: pointer; transition: all 0.16s;
  display: flex; align-items: center; justify-content: center;
  color: rgba(255,255,255,0.9);
  /* –õ—ë–≥–∫–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 2px 6px rgba(0,0,0,0.2);
}
.dp-btn:active { transform: scale(0.83) !important; background: rgba(255,255,255,0.25); }
.dp-btn:hover { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.45); transform: scale(1.06); }
.dp-btn.active-pos {
  background: rgba(212,240,26,0.22);
  border-color: rgba(212,240,26,0.8);
  color: var(--lime);
  box-shadow: 0 0 12px rgba(212,240,26,0.4), inset 0 1px 0 rgba(212,240,26,0.3);
  filter: brightness(1.15);
}

/* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
#game-field {
  flex: 1; min-width: 0; position: relative;
  /* –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π, –±–æ–≥–∞—Ç—ã–π —Å–∏–Ω–∏–π ‚Äî –∫–∞–∫ –Ω–æ—á–Ω–æ–µ –Ω–µ–±–æ */
  background:
    radial-gradient(ellipse 70% 50% at 50% 100%, rgba(0,40,120,0.6) 0%, transparent 70%),
    linear-gradient(180deg, #0d47d1 0%, #0b3db8 40%, #0930a0 100%);
  overflow: hidden;
  border-left: 1px solid rgba(255,255,255,0.08);
  border-right: 1px solid rgba(255,255,255,0.08);
}

/* –¢–æ–Ω–∫–∞—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –º–µ–∂–¥—É –≤–µ—Ä—Ö–Ω–∏–º –∏ –Ω–∏–∂–Ω–∏–º —Ä—è–¥–∞–º–∏ */
#game-field::after {
  content: '';
  position: absolute;
  left: 5%; right: 5%;
  top: 50%;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1) 20%, rgba(255,255,255,0.1) 80%, transparent);
  pointer-events: none;
  z-index: 1;
}

/* –î–µ–∫–æ—Ä ‚Äî —Å–≤–µ—á–µ–Ω–∏–µ —Å–Ω–∏–∑—É –≥–¥–µ —Å—Ç–æ–∏—Ç –≤–æ–ª–∫ */
#game-field::before {
  content: ''; position: absolute;
  width: 60%; height: 35%;
  left: 20%; bottom: 0;
  background: radial-gradient(ellipse, rgba(47,199,247,0.08) 0%, transparent 70%);
  pointer-events: none; z-index: 0;
  animation: orb 6s ease-in-out infinite alternate;
}
@keyframes orb { 0%{opacity:0.5;} 100%{opacity:1;} }

.field-inner { position: relative; width: 100%; height: 100%; }

/* –ö—É—Ä–∏—Ü—ã */
.chicken {
  position: absolute; font-size: 1.8rem; z-index: 10;
  filter: drop-shadow(0 2px 10px rgba(0,0,0,0.4));
  transition: transform 0.15s;
  line-height: 1;
}
.chicken.lay { animation: chickenLay 0.38s ease; }
@keyframes chickenLay {
  0%{transform:scale(1)rotate(0)} 35%{transform:scale(1.3)rotate(-15deg)}
  70%{transform:scale(1.1)rotate(8deg)} 100%{transform:scale(1)rotate(0)}
}

/* –ñ—ë–ª–æ–±–∞ */
.lane {
  position: absolute; transform-origin: 0 50%;
  border-radius: 6px;
  /* –ú–∞—Ç–æ–≤–æ–µ —Å—Ç–µ–∫–ª–æ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */
  background: linear-gradient(180deg,
    rgba(255,255,255,0.35) 0%,
    rgba(255,255,255,0.15) 50%,
    rgba(255,255,255,0.25) 100%);
  border-top: 1px solid rgba(255,255,255,0.55);
  border-bottom: 1px solid rgba(255,255,255,0.12);
  box-shadow:
    0 2px 8px rgba(0,0,0,0.25),
    inset 0 1px 0 rgba(255,255,255,0.4);
}

/* –ü–æ–¥–ø–∏—Å—å –∂—ë–ª–æ–±–∞ */
.lane-label {
  position: absolute;
  z-index: 25;
  font-size: 0.52rem;
  font-weight: 800;
  color: rgba(255,255,255,0.7);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  pointer-events: none;
  text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  white-space: nowrap;
}

/* –Ø–π—Ü–∞ */
.egg {
  position: absolute; font-size: 1.5rem; z-index: 20; pointer-events: none;
  transition: left 0.38s cubic-bezier(0.4,0,0.2,1), top 0.38s cubic-bezier(0.4,0,0.2,1);
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));
  line-height: 1;
}
.egg.caught { animation: eggCaught 0.42s ease forwards; }
@keyframes eggCaught {
  0%  { transform:scale(1); opacity:1; }
  40% { transform:scale(1.8); filter:drop-shadow(0 0 18px rgba(212,240,26,0.95))brightness(2.4); }
  100%{ transform:scale(0); opacity:0; }
}
.egg.broken { animation: eggBroken 0.5s ease forwards; }
@keyframes eggBroken {
  0%  { transform:scale(1)rotate(0); opacity:1; }
  35% { transform:scale(1.4)rotate(22deg); filter:drop-shadow(0 0 16px rgba(255,59,92,0.9)); }
  100%{ transform:scale(0.4)rotate(50deg); opacity:0; }
}

/* –í–æ–ª–∫ SVG */
#wolf {
  position: absolute; z-index: 30; pointer-events: none;
  transition: left 0.13s cubic-bezier(0.34,1.4,0.64,1), top 0.13s cubic-bezier(0.34,1.4,0.64,1);
  width: 54px;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,0.5));
}

/* Splat */
.splat {
  position: absolute; font-size: 1rem; z-index: 15; pointer-events: none;
  animation: splatAnim 0.9s ease forwards;
}
@keyframes splatAnim { 0%{transform:scale(0.4);opacity:1} 35%{transform:scale(1.5);opacity:1} 100%{transform:scale(1.1);opacity:0} }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –û–í–ï–†–õ–ï–ò ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—ã
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.overlay {
  position: fixed; inset: 0; z-index: 200;
  display: flex; align-items: center; justify-content: center;
  background: rgba(14,60,180,0.72);
  backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
  animation: fadeIn 0.25s ease;
}
@keyframes fadeIn { from{opacity:0} to{opacity:1} }

.modal {
  background: rgba(255,255,255,0.14);
  backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
  border: 1.5px solid rgba(255,255,255,0.28); border-radius: 20px;
  padding: 28px 36px; text-align: center;
  /* –®–∏—Ä–æ–∫–∏–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –º–æ–¥–∞–ª */
  max-width: 560px; width: 90%;
  box-shadow: 0 24px 64px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.18);
  animation: modalPop 0.42s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes modalPop { from{transform:scale(0.82)translateY(12px);opacity:0} to{transform:scale(1)translateY(0);opacity:1} }

.modal-title-go { font-size: 1.35rem; font-weight: 900; color: var(--text-white); margin-bottom: 6px; }
.modal-title-pause { font-size: 1.8rem; font-weight: 900; color: var(--text-white); margin-bottom: 18px; letter-spacing: -0.02em; }

.modal-score-row { display: flex; align-items: baseline; justify-content: center; gap: 10px; margin-bottom: 16px; }
.modal-score-label { font-size: 0.62rem; font-weight: 700; color: var(--text-muted); letter-spacing: 0.2em; text-transform: uppercase; }
.modal-score { font-size: 3rem; font-weight: 900; color: var(--lime); text-shadow: 0 0 20px rgba(212,240,26,0.5); letter-spacing: -0.03em; line-height: 1; animation: countIn 0.5s cubic-bezier(0.34,1.4,0.64,1); }
@keyframes countIn { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }

.modal-hs { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 18px; }

.new-record-badge {
  font-size: 0.8rem; font-weight: 800; color: var(--black);
  background: var(--lime); border-radius: 999px; padding: 4px 16px; margin-bottom: 12px;
  display: inline-block; text-transform: uppercase; letter-spacing: 0.06em;
  animation: recordPop 0.5s 0.2s both cubic-bezier(0.34,1.56,0.64,1), limePulse 1.5s 0.7s ease-in-out infinite alternate;
}
@keyframes recordPop { from{transform:scale(0);opacity:0} to{transform:scale(1);opacity:1} }
@keyframes limePulse { 0%{box-shadow:0 0 8px rgba(212,240,26,0.4)} 100%{box-shadow:0 0 22px rgba(212,240,26,0.85)} }

/* –ö–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ –≤ –º–æ–¥–∞–ª–µ */
.modal-btns { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
.modal-btns .btn-lime   { display: inline-block; width: auto; padding: 12px 28px; margin-bottom: 0; }
.modal-btns .btn-outline{ display: inline-block; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ê–ù–ò–ú–ê–¶–ò–ò
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.shake { animation: shake 0.32s ease; }
@keyframes shake {
  0%,100%{transform:translateX(0)} 15%{transform:translateX(-8px)} 30%{transform:translateX(8px)}
  45%{transform:translateX(-5px)} 65%{transform:translateX(5px)} 82%{transform:translateX(-3px)}
}
.flash-red { animation: flashRed 0.42s ease; }
@keyframes flashRed {
  0%,100%{box-shadow:none}
  50%{box-shadow:inset 0 0 70px rgba(255,59,92,0.55),0 0 40px rgba(255,59,92,0.2)}
}
.easter-msg {
  position: fixed; top: 35%; left: 50%; transform: translate(-50%,-50%);
  font-size: 1.6rem; font-weight: 900; color: var(--lime);
  text-shadow: 0 0 28px rgba(212,240,26,0.85); z-index: 300;
  animation: easterPop 2.1s ease forwards; pointer-events: none;
}
@keyframes easterPop {
  0%  {transform:translate(-50%,-50%)scale(0);opacity:0}
  18% {transform:translate(-50%,-60%)scale(1.15);opacity:1}
  72% {transform:translate(-50%,-60%)scale(1);opacity:1}
  100%{transform:translate(-50%,-80%)scale(0.8);opacity:0}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ê–î–ê–ü–¢–ò–í ‚Äî desktop wide
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
@media (min-width: 900px) {
  .dpad-panel { width: 100px; }
  .dp-btn { width: 52px; height: 44px; font-size: 1.2rem; }
}
@media (max-height: 520px) {
  .game-header { padding: 4px 14px; }
  .score-value { font-size: 1.3rem; }
  .dp-btn { width: 40px; height: 36px; font-size: 1rem; }
  .dpad-panel { width: 76px; }
}

/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ –≤—ã—Å–æ—Ç–µ –µ—Å–ª–∏ –≤—ã—Å–æ—Ç–∞ > max */
body { display: flex; align-items: center; justify-content: center; }
</style>
</head>
<body>

<!-- ‚ïê‚ïê ROTATE WARNING ‚ïê‚ïê -->
<div id="rotate-warning">
  <div class="rw-icon">üì±</div>
  <div>
    <div class="rw-title">–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</div>
    <div class="rw-sub">–ò–≥—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞</div>
  </div>
</div>

<!-- ‚ïê‚ïê GAME CONTAINER ‚ïê‚ïê -->
<div id="game-container">

  <!-- ‚ïê‚ïê‚ïê‚ïê –ú–ï–ù–Æ ‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-menu" class="screen active" style="position:relative;">

    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="menu-left">
      <div class="menu-logo">
        <div class="menu-logo-text">Pavel</div>
        <div class="logo-dot"></div>
      </div>
      <div class="menu-title">–í–æ–ª–∫ –ª–æ–≤–∏—Ç —è–π—Ü–∞</div>
      <div class="menu-subtitle">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–æ–≤–µ—Ç—Å–∫–∞—è –∞—Ä–∫–∞–¥–∞ ¬∑ –ù—É, –ø–æ–≥–æ–¥–∏!</div>

      <div class="menu-hs-row">
        <div>
          <div class="menu-hs-label">üèÜ –†–µ–∫–æ—Ä–¥</div>
        </div>
        <div class="menu-hs-value" id="menu-highscore">000</div>
      </div>

      <button class="btn btn-lime" onclick="Game.start('A')">–ò–≥—Ä–∞ A ‚Äî –ù–æ—Ä–º–∞–ª—å–Ω–æ</button>
      <button class="btn btn-glass" onclick="Game.start('B')">‚ö° –ò–≥—Ä–∞ B ‚Äî –°–ª–æ–∂–Ω–æ</button>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="menu-right">
      <div class="ctrl-card">
        <h3>‚å® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
        <div style="margin-bottom:10px;font-size:0.7rem;color:var(--text-dim);font-weight:600;text-transform:uppercase;letter-spacing:0.08em;">üíª –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞</div>
        <div class="ctrl-grid">
          <div class="ctrl-item"><span class="key">‚Üê</span> –õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞</div>
          <div class="ctrl-item"><span class="key">‚Üí</span> –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞</div>
          <div class="ctrl-item"><span class="key">‚Üë</span> –í–µ—Ä—Ö–Ω–∏–π –∂—ë–ª–æ–±</div>
          <div class="ctrl-item"><span class="key">‚Üì</span> –ù–∏–∂–Ω–∏–π –∂—ë–ª–æ–±</div>
        </div>
        <div class="ctrl-note" style="margin-top:8px;">
          ‚Üê + ‚Üë = –ª–µ–≤–æ-–≤–µ—Ä—Ö &nbsp;¬∑&nbsp; ‚Üê + ‚Üì = –ª–µ–≤–æ-–Ω–∏–∑<br>
          ‚Üí + ‚Üë = –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö &nbsp;¬∑&nbsp; ‚Üí + ‚Üì = –ø—Ä–∞–≤–æ-–Ω–∏–∑<br>
          <span style="margin-top:4px;display:block;">ESC / –ü—Ä–æ–±–µ–ª = –ø–∞—É–∑–∞</span>
        </div>
        <div style="margin-top:14px;font-size:0.7rem;color:var(--text-dim);font-weight:600;text-transform:uppercase;letter-spacing:0.08em;">üì± –ú–æ–±–∏–ª—å–Ω—ã–π</div>
        <div class="ctrl-note" style="margin-top:4px;">D-pad –∫–Ω–æ–ø–∫–∏ —Å–ª–µ–≤–∞ –∏ —Å–ø—Ä–∞–≤–∞ –æ—Ç –ø–æ–ª—è.<br>–û–±–∞ D-pad'–∞ –¥—É–±–ª–∏—Ä—É—é—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.</div>
      </div>

      <div style="text-align:center;font-size:0.65rem;color:var(--text-muted);margin-top:auto;padding-top:10px;">
        ¬© 2025 Pavel Game Studio
      </div>
    </div>

  </div><!-- /screen-menu -->

  <!-- ‚ïê‚ïê‚ïê‚ïê –ò–ì–†–ê ‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-game" class="screen">

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="game-header">
      <div class="game-header-left">
        <div class="logo-small">Pavel<span class="logo-dot"></span></div>
        <div class="score-block">
          <div class="score-label">–°—á—ë—Ç</div>
          <div class="score-value" id="score-display">000</div>
        </div>
      </div>
      <div class="game-header-center">
        <span class="mode-badge" id="mode-display">–†–µ–∂–∏–º A</span>
        <div class="lives-block">
          <span class="life-icon" id="life-0">ü•ö</span>
          <span class="life-icon" id="life-1">ü•ö</span>
          <span class="life-icon" id="life-2">ü•ö</span>
        </div>
      </div>
      <div class="game-header-right">
        <button class="sound-btn" id="sound-toggle" onclick="Sound.toggle()">üîä</button>
        <button class="btn btn-icon" onclick="openFullscreen()">‚õ∂</button>
        <button class="btn btn-icon" onclick="Game.pause()">‚è∏ –ü–∞—É–∑–∞</button>
      </div>
    </div>

    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞: D-pad | –ü–æ–ª–µ | D-pad -->
    <div class="game-main">

      <!-- –õ–µ–≤—ã–π D-pad -->
      <div class="dpad-panel" id="dpad-left">
        <div class="dpad-label">–õ–µ–≤–æ</div>
        <!-- ‚Üë —Ü–µ–Ω—Ç—Ä -->
        <div class="dpad-row">
          <button class="dp-btn" id="btn-up-L" ontouchstart="dpadUp();return false;" onclick="dpadUp()">‚Üë</button>
        </div>
        <!-- ‚Üê (–ª–µ–≤–æ) -->
        <div class="dpad-row">
          <button class="dp-btn" id="btn-left" ontouchstart="dpadLeft();return false;" onclick="dpadLeft()">‚Üê</button>
        </div>
        <!-- ‚Üì —Ü–µ–Ω—Ç—Ä -->
        <div class="dpad-row">
          <button class="dp-btn" id="btn-dn-L" ontouchstart="dpadDown();return false;" onclick="dpadDown()">‚Üì</button>
        </div>
      </div>

      <!-- –ü–æ–ª–µ -->
      <div id="game-field">
        <div class="field-inner" id="field-inner">
          <!-- –ó–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏ -->
          <div style="position:absolute;left:50%;top:6%;transform:translateX(-50%);z-index:2;font-size:0.5rem;font-weight:800;color:rgba(212,240,26,0.7);letter-spacing:0.2em;text-transform:uppercase;pointer-events:none;text-shadow:0 1px 4px rgba(0,0,0,0.6);">‚ñ≤ –í–ï–†–•–ù–ò–ô –†–Ø–î</div>
          <div style="position:absolute;left:50%;top:52%;transform:translateX(-50%);z-index:2;font-size:0.5rem;font-weight:800;color:rgba(255,255,255,0.45);letter-spacing:0.2em;text-transform:uppercase;pointer-events:none;text-shadow:0 1px 4px rgba(0,0,0,0.6);">‚ñº –ù–ò–ñ–ù–ò–ô –†–Ø–î</div>
          <div class="chicken" id="chicken-0">üêî</div>
          <div class="chicken" id="chicken-1">üêî</div>
          <div class="chicken" id="chicken-2">üêî</div>
          <div class="chicken" id="chicken-3">üêî</div>
          <!-- –í–æ–ª–∫ ¬´–ù—É, –ø–æ–≥–æ–¥–∏¬ª SVG -->
          <div id="wolf">
            <svg width="48" height="64" viewBox="0 0 52 68" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="13" y="30" width="26" height="28" rx="5" fill="#FFFFFF"/>
              <rect x="13" y="36" width="26" height="3" rx="1" fill="#D0D0D0"/>
              <rect x="13" y="43" width="26" height="3" rx="1" fill="#D0D0D0"/>
              <rect x="13" y="52" width="11" height="16" rx="3" fill="#1a3a8a"/>
              <rect x="28" y="52" width="11" height="16" rx="3" fill="#1a3a8a"/>
              <rect x="11" y="62" width="14" height="6" rx="3" fill="#222"/>
              <rect x="27" y="62" width="14" height="6" rx="3" fill="#222"/>
              <rect x="22" y="25" width="8" height="8" rx="2" fill="#8A8A8A"/>
              <ellipse cx="26" cy="18" rx="14" ry="13" fill="#8A8A8A"/>
              <ellipse cx="26" cy="22" rx="8" ry="6" fill="#AFAFAF"/>
              <polygon points="12,8 8,0 18,6" fill="#8A8A8A"/>
              <polygon points="40,8 44,0 34,6" fill="#8A8A8A"/>
              <polygon points="13,7 10,2 17,6" fill="#D08080"/>
              <polygon points="39,7 42,2 35,6" fill="#D08080"/>
              <ellipse cx="20" cy="16" rx="3.5" ry="3.5" fill="white"/>
              <ellipse cx="32" cy="16" rx="3.5" ry="3.5" fill="white"/>
              <circle cx="21" cy="16" r="2" fill="#222"/>
              <circle cx="33" cy="16" r="2" fill="#222"/>
              <circle cx="22" cy="15" r="0.8" fill="white"/>
              <circle cx="34" cy="15" r="0.8" fill="white"/>
              <ellipse cx="26" cy="22" rx="3" ry="2" fill="#555"/>
              <path d="M21 26 Q26 30 31 26" stroke="#555" stroke-width="1.5" stroke-linecap="round" fill="none"/>
              <rect x="30" y="25" width="12" height="3" rx="1.5" fill="#f5f5dc"/>
              <rect x="40" y="25" width="4" height="3" rx="1" fill="#FF6633"/>
              <path d="M42 24 Q44 20 42 17 Q40 14 42 11" stroke="rgba(255,255,255,0.5)" stroke-width="1.5" stroke-linecap="round" fill="none"/>
              <rect x="2" y="32" width="13" height="7" rx="3.5" fill="#8A8A8A"/>
              <rect x="37" y="32" width="13" height="7" rx="3.5" fill="#8A8A8A"/>
              <rect x="36" y="38" width="16" height="12" rx="3" fill="#C8A256"/>
              <rect x="36" y="38" width="16" height="3" rx="1" fill="#B8922A"/>
              <path d="M40 38 Q44 32 48 38" stroke="#B8922A" stroke-width="2" fill="none" stroke-linecap="round"/>
              <line x1="40" y1="41" x2="40" y2="50" stroke="#B8922A" stroke-width="1"/>
              <line x1="44" y1="41" x2="44" y2="50" stroke="#B8922A" stroke-width="1"/>
              <line x1="48" y1="41" x2="48" y2="50" stroke="#B8922A" stroke-width="1"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤—ã–π D-pad -->
      <div class="dpad-panel" id="dpad-right">
        <div class="dpad-label">–ü—Ä–∞–≤–æ</div>
        <div class="dpad-row">
          <button class="dp-btn" id="btn-up-R" ontouchstart="dpadUp();return false;" onclick="dpadUp()">‚Üë</button>
        </div>
        <div class="dpad-row">
          <button class="dp-btn" id="btn-right" ontouchstart="dpadRight();return false;" onclick="dpadRight()">‚Üí</button>
        </div>
        <div class="dpad-row">
          <button class="dp-btn" id="btn-dn-R" ontouchstart="dpadDown();return false;" onclick="dpadDown()">‚Üì</button>
        </div>
      </div>

    </div><!-- /game-main -->
  </div><!-- /screen-game -->

</div><!-- /game-container -->

<!-- –ü–ê–£–ó–ê -->
<div id="overlay-pause" class="overlay" style="display:none;">
  <div class="modal">
    <div class="modal-title-pause">‚è∏ –ü–ê–£–ó–ê</div>
    <div class="modal-btns">
      <button class="btn btn-lime" onclick="Game.resume()">‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      <button class="btn btn-outline" onclick="Game.toMenu()">üè† –ú–µ–Ω—é</button>
    </div>
  </div>
</div>

<!-- GAME OVER -->
<div id="overlay-gameover" class="overlay" style="display:none;">
  <div class="modal">
    <div class="modal-title-go">üíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</div>
    <div class="modal-score-row">
      <div class="modal-score-label">–°—á—ë—Ç</div>
      <div class="modal-score" id="go-score">000</div>
    </div>
    <div class="new-record-badge" id="go-newrecord" style="display:none">üåü –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!</div>
    <div class="modal-hs" id="go-highscore">–†–µ–∫–æ—Ä–¥: 000</div>
    <div class="modal-btns">
      <button class="btn btn-lime" onclick="Game.restart()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
      <button class="btn btn-outline" onclick="Game.toMenu()">üè† –ú–µ–Ω—é</button>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –û–®–ò–ë–ö–ò ‚Äî –Ω–µ –ª–æ–º–∞—é—Ç –ë24
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.onerror = function(msg,url,line){ console.error('Game error:',msg,url,line); return true; };

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ë–ò–¢–†–ò–ö–°24 ‚Äî –¥–µ—Ç–µ–∫—Ü–∏—è –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const isB24 = typeof BX24 !== 'undefined';

document.addEventListener('DOMContentLoaded', function() {
  if (isB24) {
    try {
      BX24.init(function() {
        initGame();
        adjustFrameSize();
      });
    } catch(e) { initGame(); }
  } else {
    initGame();
  }
});

function adjustFrameSize() {
  if (!isB24) return;
  try { BX24.resizeWindow(1050, 640, function(){}); } catch(e){}
}

function openFullscreen() {
  if (isB24) {
    try { BX24.openApplication({}); } catch(e) {}
  } else {
    try {
      if (!document.fullscreenElement) document.documentElement.requestFullscreen();
      else document.exitFullscreen();
    } catch(e){}
  }
}

// Resize –≤ –ë24 ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–ª–µ
if (isB24) {
  window.addEventListener('resize', () => {
    if (document.getElementById('screen-game').classList.contains('active')) {
      layoutField();
    }
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –†–ï–ö–û–†–î–´ ‚Äî localStorage + BX24.userOption
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function saveHighscore(score) {
  localStorage.setItem('wolfHS4', score);
  if (isB24) { try { BX24.userOption.set('wolfHS4', score); } catch(e){} }
}
function loadHighscore() {
  const local = parseInt(localStorage.getItem('wolfHS4') || '0');
  if (isB24) {
    try {
      const b24val = BX24.userOption.get('wolfHS4');
      return Math.max(local, parseInt(b24val) || 0);
    } catch(e) {}
  }
  return local;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SOUND
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const Sound = (() => {
  let ctx=null, on=true;
  function ac(){ if(!ctx) ctx=new(window.AudioContext||window.webkitAudioContext)(); return ctx; }
  function tone(freq,dur,type='sine',vol=0.28,delay=0){
    if(!on) return;
    try{
      const c=ac(),o=c.createOscillator(),g=c.createGain();
      o.connect(g); g.connect(c.destination);
      o.type=type; o.frequency.value=freq;
      const t=c.currentTime+delay;
      g.gain.setValueAtTime(vol,t);
      g.gain.exponentialRampToValueAtTime(0.001,t+dur);
      o.start(t); o.stop(t+dur+0.01);
    }catch(e){}
  }
  function noise(dur,vol=0.18){
    if(!on) return;
    try{
      const c=ac(),buf=c.createBuffer(1,c.sampleRate*dur,c.sampleRate);
      const d=buf.getChannelData(0);
      for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
      const s=c.createBufferSource(); s.buffer=buf;
      const g=c.createGain(); s.connect(g); g.connect(c.destination);
      g.gain.setValueAtTime(vol,c.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+dur);
      s.start();
    }catch(e){}
  }
  return {
    playCapture(){ tone(900,0.08,'sine',0.3); tone(1200,0.1,'sine',0.2,0.07); },
    playMiss()   { tone(220,0.32,'sawtooth',0.28); },
    playGameOver(){ tone(440,0.22,'sine',0.3,0); tone(330,0.22,'sine',0.3,0.25); tone(220,0.5,'sine',0.35,0.5); },
    playClick()  { noise(0.045,0.12); },
    playBonus()  { [523,659,784,1047].forEach((f,i)=>tone(f,0.14,'sine',0.22,i*0.11)); },
    toggle()     { on=!on; document.getElementById('sound-toggle').textContent=on?'üîä':'üîá'; }
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCORE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const Score = (() => {
  let score=0,misses=0,lastBonus=0;
  let hs=0; // –∑–∞–≥—Ä—É–∑–∏–º –≤ initGame
  function rScore(){
    const el=document.getElementById('score-display');
    el.textContent=String(score).padStart(3,'0');
    el.classList.remove('bounce'); void el.offsetWidth; el.classList.add('bounce');
    setTimeout(()=>el.classList.remove('bounce'),300);
  }
  function rLives(){ for(let i=0;i<3;i++) document.getElementById('life-'+i).classList.toggle('lost',i>=(3-misses)); }
  return {
    init(){ hs=loadHighscore(); },
    reset(){ score=0;misses=0;lastBonus=0;rScore();rLives(); },
    add(){
      score=Math.min(score+1,999); rScore();
      const b=Math.floor(score/100);
      if(b>lastBonus){
        lastBonus=b;
        if(misses>0){misses--;rLives();}
        Sound.playBonus();
        const m={1:'üéâ –û—Ç–ª–∏—á–Ω–æ!',2:'üî• –ú–∞—Å—Ç–µ—Ä!',5:'üëë –õ–µ–≥–µ–Ω–¥–∞!'};
        if(m[b]) showEaster(m[b]);
      }
    },
    addMiss(){ misses++;rLives();return misses; },
    get score(){ return score; },
    get misses(){ return misses; },
    get hs()   { return hs; },
    saveHs(){
      if(score>hs){ hs=score; saveHighscore(hs); return true; }
      return false;
    },
    updateMenuHs(){ document.getElementById('menu-highscore').textContent=String(hs).padStart(3,'0'); }
  };
})();

function showEaster(msg){
  const el=document.createElement('div');
  el.className='easter-msg'; el.textContent=msg;
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),2200);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UI
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const UI = {
  showMenu(){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById('screen-menu').classList.add('active');
    Score.updateMenuHs();
    document.getElementById('overlay-gameover').style.display='none';
    document.getElementById('overlay-pause').style.display='none';
  },
  showGame(){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById('screen-game').classList.add('active');
  },
  showPause()  { document.getElementById('overlay-pause').style.display='flex'; },
  hidePause()  { document.getElementById('overlay-pause').style.display='none'; },
  showGameOver(isNew){
    document.getElementById('go-score').textContent=String(Score.score).padStart(3,'0');
    document.getElementById('go-highscore').textContent='–†–µ–∫–æ—Ä–¥: '+String(Score.hs).padStart(3,'0');
    document.getElementById('go-newrecord').style.display=isNew?'inline-block':'none';
    document.getElementById('overlay-gameover').style.display='flex';
  }
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GAME FIELD ‚Äî landscape –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
   –í–æ–ª–∫ —Å—Ç–æ–∏—Ç —Å–Ω–∏–∑—É –ø–æ —Ü–µ–Ω—Ç—Ä—É.
   4 –∫—É—Ä–∏—Ü—ã –≤–≤–µ—Ä—Ö—É (–≤–µ–µ—Ä–æ–º).
   –ñ—ë–ª–æ–±–∞ –∏–¥—É—Ç –æ—Ç –∫—Ä–∞—ë–≤ –∫ —Ü–µ–Ω—Ç—Ä—É.
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const GF = {
  sz(){ const f=document.getElementById('game-field'); return {W:f.offsetWidth,H:f.offsetHeight}; },

  /*
   * –ù–û–í–ê–Ø –ö–û–ù–¶–ï–ü–¶–ò–Ø –ü–û–õ–Ø (landscape):
   *
   *  üêî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂  ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄüêî   (–í–ï–†–•–ù–ò–ô –†–Ø–î)
   *  lane 0 (–ª–µ–≤–æ)              lane 2 (–ø—Ä–∞–≤–æ)
   *
   *  üêî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂  ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄüêî   (–ù–ò–ñ–ù–ò–ô –†–Ø–î)
   *  lane 1 (–ª–µ–≤–æ)              lane 3 (–ø—Ä–∞–≤–æ)
   *
   *           üê∫ (4 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–Ω–∏–∑—É)
   *
   * –ñ—ë–ª–æ–±–∞ –ø–æ—á—Ç–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ ‚Äî –ª—ë–≥–∫–∏–π –Ω–∞–∫–ª–æ–Ω ~5¬∞.
   * –Ø–π—Ü–∞ —Å–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç –∫—Ä–∞—è –∫ —Ü–µ–Ω—Ç—Ä—É.
   * –í–æ–ª–∫ —Å—Ç–æ–∏—Ç –≤–Ω–∏–∑—É ‚Äî 4 –ø–æ–∑–∏—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç 4 –∂—ë–ª–æ–±–∞–º.
   *
   * lane 0 = –≤–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π  ‚Üí –≤–æ–ª–∫ –ø–æ–∑ 0
   * lane 1 = –Ω–∏–∂–Ω–∏–π –ª–µ–≤—ã–π   ‚Üí –≤–æ–ª–∫ –ø–æ–∑ 1
   * lane 2 = –≤–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π ‚Üí –≤–æ–ª–∫ –ø–æ–∑ 2
   * lane 3 = –Ω–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π  ‚Üí –≤–æ–ª–∫ –ø–æ–∑ 3
   */

  // –Ø–π—Ü–∞ —Å–∫–æ–ª—å–∑—è—Ç –≤–¥–æ–ª—å –∂—ë–ª–æ–±–∞ –∫ –≤–æ–ª–∫—É
  eggPos(lane, step){
    const {W,H}=this.sz();
    // –ñ—ë–ª–æ–±–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ: y –ø–æ—á—Ç–∏ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è (–ª—ë–≥–∫–∏–π —Å–ø—É—Å–∫)
    // –õ–µ–≤—ã–µ ‚Äî –∏–¥—É—Ç —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ –∫ —Ü–µ–Ω—Ç—Ä—É
    // –ü—Ä–∞–≤—ã–µ ‚Äî –∏–¥—É—Ç —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ –∫ —Ü–µ–Ω—Ç—Ä—É
    const c=[
      // lane 0: –ª–µ–≤–æ-–≤–µ—Ä—Ö.  –ö—É—Ä–∏—Ü–∞ —Å–ª–µ–≤–∞, —è–π—Ü–æ –µ–¥–µ—Ç –≤–ø—Ä–∞–≤–æ, —á—É—Ç—å –≤–Ω–∏–∑
      {sx:W*.04, sy:H*.22, ex:W*.46, ey:H*.30},
      // lane 1: –ª–µ–≤–æ-–Ω–∏–∑.   –ö—É—Ä–∏—Ü–∞ —Å–ª–µ–≤–∞, —è–π—Ü–æ –µ–¥–µ—Ç –≤–ø—Ä–∞–≤–æ, —á—É—Ç—å –≤–Ω–∏–∑
      {sx:W*.04, sy:H*.52, ex:W*.46, ey:H*.60},
      // lane 2: –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö. –ö—É—Ä–∏—Ü–∞ —Å–ø—Ä–∞–≤–∞, —è–π—Ü–æ –µ–¥–µ—Ç –≤–ª–µ–≤–æ, —á—É—Ç—å –≤–Ω–∏–∑
      {sx:W*.96, sy:H*.22, ex:W*.54, ey:H*.30},
      // lane 3: –ø—Ä–∞–≤–æ-–Ω–∏–∑.  –ö—É—Ä–∏—Ü–∞ —Å–ø—Ä–∞–≤–∞, —è–π—Ü–æ –µ–¥–µ—Ç –≤–ª–µ–≤–æ, —á—É—Ç—å –≤–Ω–∏–∑
      {sx:W*.96, sy:H*.52, ex:W*.54, ey:H*.60},
    ][lane];
    const t = step / 3;
    return {x: c.sx + (c.ex - c.sx)*t - 12, y: c.sy + (c.ey - c.sy)*t - 12};
  },

  // –ö—É—Ä–∏—Ü—ã ‚Äî –ø–æ –∫—Ä–∞—è–º, –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–≤–æ–µ–≥–æ –∂—ë–ª–æ–±–∞
  chickenPos(lane){
    const {W,H}=this.sz();
    return [
      {x: W*.01, y: H*.14},  // 0: –ª–µ–≤–æ-–≤–µ—Ä—Ö
      {x: W*.01, y: H*.44},  // 1: –ª–µ–≤–æ-–Ω–∏–∑
      {x: W*.88, y: H*.14},  // 2: –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö
      {x: W*.88, y: H*.44},  // 3: –ø—Ä–∞–≤–æ-–Ω–∏–∑
    ][lane];
  },

  // –í–æ–ª–∫ ‚Äî 4 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–Ω–∏–∑—É, –∫–∞–∂–¥–∞—è –ø–æ–¥ —Å–≤–æ–∏–º –∂—ë–ª–æ–±–æ–º
  wolfPos(pos){
    const {W,H}=this.sz();
    return [
      {x: W*.41, y: H*.26},  // 0: –ø–æ–¥ –ª–µ–≤–æ-–≤–µ—Ä—Ö–Ω–∏–º
      {x: W*.41, y: H*.56},  // 1: –ø–æ–¥ –ª–µ–≤–æ-–Ω–∏–∂–Ω–∏–º
      {x: W*.50, y: H*.26},  // 2: –ø–æ–¥ –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö–Ω–∏–º
      {x: W*.50, y: H*.56},  // 3: –ø–æ–¥ –ø—Ä–∞–≤–æ-–Ω–∏–∂–Ω–∏–º
    ][pos];
  },

  // –ñ—ë–ª–æ–±–∞ ‚Äî –ø–æ—á—Ç–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª–æ—Å—ã
  laneSeg(lane){
    const {W,H}=this.sz();
    return [
      // 0: –ª–µ–≤–æ-–≤–µ—Ä—Ö ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π, –ª—ë–≥–∫–∏–π –Ω–∞–∫–ª–æ–Ω –≤–ø—Ä–∞–≤–æ-–≤–Ω–∏–∑
      {sx: W*.06, sy: H*.25, ex: W*.47, ey: H*.30},
      // 1: –ª–µ–≤–æ-–Ω–∏–∑
      {sx: W*.06, sy: H*.55, ex: W*.47, ey: H*.60},
      // 2: –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö ‚Äî –∑–µ—Ä–∫–∞–ª—å–Ω–æ
      {sx: W*.94, sy: H*.25, ex: W*.53, ey: H*.30},
      // 3: –ø—Ä–∞–≤–æ-–Ω–∏–∑
      {sx: W*.94, sy: H*.55, ex: W*.53, ey: H*.60},
    ][lane];
  }
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WOLF
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const Wolf = (() => {
  let pos=0;
  // –î—É–±–ª–∏—Ä—É—é—â–∏–µ –æ—Å–∏ –¥–ª—è –¥–≤—É—Ö D-pad'–æ–≤
  let axisLeft=true, axisTop=true;

  function place(){
    const p=GF.wolfPos(pos);
    const el=document.getElementById('wolf');
    el.style.left=p.x+'px'; el.style.top=p.y+'px';
  }
  function highlightDpad(){
    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    const allDpBtns=['btn-left','btn-right','btn-up-L','btn-dn-L','btn-up-R','btn-dn-R'];
    allDpBtns.forEach(id=>{
      const el=document.getElementById(id);
      if(el) el.classList.remove('active-pos');
    });
    if(axisLeft){ const el=document.getElementById('btn-left'); if(el) el.classList.add('active-pos'); }
    else        { const el=document.getElementById('btn-right'); if(el) el.classList.add('active-pos'); }
    if(axisTop){ 
      ['btn-up-L','btn-up-R'].forEach(id=>{ const el=document.getElementById(id); if(el) el.classList.add('active-pos'); });
    } else {
      ['btn-dn-L','btn-dn-R'].forEach(id=>{ const el=document.getElementById(id); if(el) el.classList.add('active-pos'); });
    }
  }
  function calcPos(){
    if( axisLeft &&  axisTop) return 0;
    if( axisLeft && !axisTop) return 1;
    if(!axisLeft &&  axisTop) return 2;
    return 3;
  }
  function update(){ pos=calcPos(); place(); highlightDpad(); Sound.playClick(); }

  return {
    get pos(){ return pos; },
    setLeft(){ axisLeft=true;  update(); },
    setRight(){ axisLeft=false; update(); },
    setUp()  { axisTop=true;   update(); },
    setDown(){ axisTop=false;  update(); },
    render() { place(); highlightDpad(); },
    reset()  { axisLeft=true; axisTop=true; pos=0; place(); highlightDpad(); }
  };
})();

// D-pad —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –æ–±–∞ D-pad'–∞ –≤—ã–∑—ã–≤–∞—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ
function dpadLeft()  { if(gameIsActive()) Wolf.setLeft(); }
function dpadRight() { if(gameIsActive()) Wolf.setRight(); }
function dpadUp()    { if(gameIsActive()) Wolf.setUp(); }
function dpadDown()  { if(gameIsActive()) Wolf.setDown(); }
function gameIsActive(){ return document.getElementById('screen-game').classList.contains('active'); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EGG
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
class Egg {
  constructor(lane){
    this.lane=lane; this.step=0; this.active=true;
    this.el=document.createElement('div');
    this.el.className='egg'; this.el.textContent='ü•ö';
    document.getElementById('field-inner').appendChild(this.el);
    this.render();
    const ch=document.getElementById('chicken-'+lane);
    if(ch){ ch.classList.add('lay'); setTimeout(()=>ch.classList.remove('lay'),400); }
  }
  render(){ const p=GF.eggPos(this.lane,this.step); this.el.style.left=p.x+'px'; this.el.style.top=p.y+'px'; }
  advance(){ this.step++; this.render(); }
  catch(){ this.active=false; this.el.classList.add('caught'); setTimeout(()=>this.el.remove(),450); }
  break(){
    this.active=false; this.el.classList.add('broken');
    const s=document.createElement('div'); s.className='splat'; s.textContent='üí•';
    const p=GF.eggPos(this.lane,this.step);
    s.style.left=p.x+'px'; s.style.top=p.y+'px';
    document.getElementById('field-inner').appendChild(s);
    setTimeout(()=>s.remove(),920); setTimeout(()=>this.el.remove(),560);
  }
  destroy(){ this.active=false; if(this.el.parentNode) this.el.remove(); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN GAME
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const Game = (() => {
  let mode='A',eggs=[],occ=[false,false,false,false];
  let running=false,paused=false,frameId=null;
  let moveDelay=500,spawnDelay=2000;
  let mt=0,st=0,lt=0;

  function calcSpeed(){
    const f=Math.pow(0.9,Math.floor(Score.score/50));
    moveDelay =Math.max(mode==='A'?200:150, Math.round((mode==='A'?500:380)*f));
    spawnDelay=Math.max(mode==='A'?600:400, Math.round((mode==='A'?2000:1400)*f));
  }
  function spawnEgg(){
    const free=[0,1,2,3].filter(i=>!occ[i]);
    if(!free.length) return;
    const lane=free[Math.floor(Math.random()*free.length)];
    occ[lane]=true; eggs.push(new Egg(lane));
  }
  function tickEggs(){
    for(let i=eggs.length-1;i>=0;i--){
      const e=eggs[i];
      if(!e.active){eggs.splice(i,1);continue;}
      if(e.step>=3){
        if(Wolf.pos===e.lane){
          e.catch(); Score.add(); Sound.playCapture(); calcSpeed();
        } else {
          e.break(); const m=Score.addMiss(); Sound.playMiss();
          const field=document.getElementById('game-field');
          field.classList.add('shake'); setTimeout(()=>field.classList.remove('shake'),340);
          field.classList.add('flash-red'); setTimeout(()=>field.classList.remove('flash-red'),420);
          occ[e.lane]=false; eggs.splice(i,1);
          if(m>=3){running=false; setTimeout(endGame,700); return;}
          continue;
        }
        occ[e.lane]=false; eggs.splice(i,1);
      } else { e.advance(); }
    }
  }
  function loop(ts){
    if(!running||paused) return;
    const dt=Math.min(ts-lt,200); lt=ts;
    mt+=dt; st+=dt;
    if(st>=spawnDelay){st=0;spawnEgg();}
    if(mt>=moveDelay) {mt=0;tickEggs();}
    if(running&&!paused) frameId=requestAnimationFrame(loop);
  }
  function clearEggs(){ eggs.forEach(e=>e.destroy()); eggs=[]; occ=[false,false,false,false]; }

  return {
    start(m){
      mode=m; Score.reset(); Wolf.reset();
      document.getElementById('mode-display').textContent='–†–µ–∂–∏–º '+m;
      UI.showGame();
      setTimeout(()=>{
        layoutField(); calcSpeed(); clearEggs();
        running=true; paused=false;
        mt=0; st=spawnDelay*0.4; lt=performance.now();
        frameId=requestAnimationFrame(loop);
      },120);
    },
    restart(){
      document.getElementById('overlay-gameover').style.display='none';
      Game.start(mode);
    },
    pause(){
      if(!running||paused) return;
      paused=true;
      if(frameId){cancelAnimationFrame(frameId);frameId=null;}
      UI.showPause();
    },
    resume(){
      paused=false; UI.hidePause();
      lt=performance.now(); frameId=requestAnimationFrame(loop);
    },
    toMenu(){
      running=false; paused=false;
      if(frameId){cancelAnimationFrame(frameId);frameId=null;}
      clearEggs();
      document.getElementById('overlay-gameover').style.display='none';
      document.getElementById('overlay-pause').style.display='none';
      UI.showMenu();
    }
  };

  function endGame(){
    if(frameId){cancelAnimationFrame(frameId);frameId=null;}
    clearEggs(); Sound.playGameOver();
    const isNew=Score.saveHs();
    setTimeout(()=>UI.showGameOver(isNew),450);
  }
  // expose endGame —á–µ—Ä–µ–∑ closure
  Game._endGame = endGame; // –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º–æ ‚Äî –∏—Å–ø—Ä–∞–≤–∏–º –Ω–∏–∂–µ
})();

/* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º endGame ‚Äî –≤—ã–Ω–æ—Å–∏–º –∏–∑ closure */
function _endGame(){
  // –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ tickEggs —á–µ—Ä–µ–∑ Game._end
  Game._end();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LAYOUT FIELD
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function layoutField(){
  for(let i=0;i<4;i++){
    const c=document.getElementById('chicken-'+i);
    const p=GF.chickenPos(i); c.style.left=p.x+'px'; c.style.top=p.y+'px';
  }
  document.querySelectorAll('.lane').forEach(l=>l.remove());
  document.querySelectorAll('.lane-label').forEach(l=>l.remove());
  for(let i=0;i<4;i++) drawLane(i);
  Wolf.render();
}

function drawLane(lane){
  const s=GF.laneSeg(lane);
  const dx=s.ex-s.sx,dy=s.ey-s.sy;
  const len=Math.sqrt(dx*dx+dy*dy),angle=Math.atan2(dy,dx)*180/Math.PI;

  // –ñ—ë–ª–æ–± ‚Äî —Ç–æ–ª—â–µ, —Ö–æ—Ä–æ—à–æ –≤–∏–¥–µ–Ω
  const el=document.createElement('div');
  el.className='lane';
  el.style.cssText=`width:${len}px;height:11px;left:${s.sx}px;top:${s.sy}px;transform:rotate(${angle}deg)`;
  document.getElementById('field-inner').appendChild(el);

  // –ü–æ–¥–ø–∏—Å—å –Ω–∞–¥ –∂—ë–ª–æ–±–æ–º
  const labels=['‚Üë –í–ï–†–•','‚Üì –ù–ò–ó','‚Üë –í–ï–†–•','‚Üì –ù–ò–ó'];
  const colors=['rgba(212,240,26,0.85)','rgba(255,255,255,0.55)','rgba(212,240,26,0.85)','rgba(255,255,255,0.55)'];
  const lbl=document.createElement('div');
  lbl.className='lane-label';
  // –°—Ç–∞–≤–∏–º –ø–æ–¥–ø–∏—Å—å –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –∂—ë–ª–æ–±–∞
  const mx=(s.sx+s.ex)/2 - 18;
  const my=Math.min(s.sy,s.ey) - 16;
  lbl.style.cssText=`left:${mx}px;top:${my}px;color:${colors[lane]};`;
  lbl.textContent=labels[lane];
  document.getElementById('field-inner').appendChild(lbl);
}

function recalculateGameField(){
  if(!document.getElementById('screen-game').classList.contains('active')) return;
  document.querySelectorAll('.lane-label').forEach(l=>l.remove());
  layoutField();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   KEYBOARD ‚Äî —Å—Ç—Ä–µ–ª–∫–∏
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('keydown',e=>{
  if(!gameIsActive()) return;
  switch(e.key){
    case 'ArrowLeft':  Wolf.setLeft();  e.preventDefault(); break;
    case 'ArrowRight': Wolf.setRight(); e.preventDefault(); break;
    case 'ArrowUp':    Wolf.setUp();    e.preventDefault(); break;
    case 'ArrowDown':  Wolf.setDown();  e.preventDefault(); break;
    case 'Escape': case ' ':
      if(document.getElementById('overlay-pause').style.display==='flex') Game.resume();
      else Game.pause();
      e.preventDefault(); break;
  }
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RESIZE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.addEventListener('resize',()=>{ recalculateGameField(); });

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ DOMContentLoaded / BX24.init
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function initGame(){
  Score.init();
  Score.updateMenuHs();
}

// –§–æ–ª–±—ç–∫ ‚Äî –µ—Å–ª–∏ DOMContentLoaded —É–∂–µ —Å—Ä–∞–±–æ—Ç–∞–ª (BX24 –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è)
if(document.readyState==='complete'||document.readyState==='interactive'){
  if(!isB24){ initGame(); }
}
</script>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ü–ê–¢–ß: endGame –≤–Ω—É—Ç—Ä–∏ Game-closure –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Å–Ω–∞—Ä—É–∂–∏.
   –ü–µ—Ä–µ–ø–∏—à–µ–º Game —á–µ—Ä–µ–∑ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç.
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

// –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º Game –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
(function(){
  let mode='A',eggs2=[],occ2=[false,false,false,false];
  let running2=false,paused2=false,frameId2=null;
  let moveDelay2=500,spawnDelay2=2000;
  let mt2=0,st2=0,lt2=0;

  function calcSpeed2(){
    const f=Math.pow(0.9,Math.floor(Score.score/50));
    moveDelay2 =Math.max(mode==='A'?200:150, Math.round((mode==='A'?500:380)*f));
    spawnDelay2=Math.max(mode==='A'?600:400, Math.round((mode==='A'?2000:1400)*f));
  }
  function spawnEgg2(){
    const free=[0,1,2,3].filter(i=>!occ2[i]);
    if(!free.length) return;
    const lane=free[Math.floor(Math.random()*free.length)];
    occ2[lane]=true; eggs2.push(new Egg(lane));
  }
  function clearEggs2(){ eggs2.forEach(e=>e.destroy()); eggs2=[]; occ2=[false,false,false,false]; }

  function endGame2(){
    if(frameId2){cancelAnimationFrame(frameId2);frameId2=null;}
    clearEggs2(); Sound.playGameOver();
    const isNew=Score.saveHs();
    setTimeout(()=>UI.showGameOver(isNew),450);
  }

  function tickEggs2(){
    for(let i=eggs2.length-1;i>=0;i--){
      const e=eggs2[i];
      if(!e.active){eggs2.splice(i,1);continue;}
      if(e.step>=3){
        if(Wolf.pos===e.lane){
          e.catch(); Score.add(); Sound.playCapture(); calcSpeed2();
        } else {
          e.break(); const m=Score.addMiss(); Sound.playMiss();
          const field=document.getElementById('game-field');
          field.classList.add('shake'); setTimeout(()=>field.classList.remove('shake'),340);
          field.classList.add('flash-red'); setTimeout(()=>field.classList.remove('flash-red'),420);
          occ2[e.lane]=false; eggs2.splice(i,1);
          if(m>=3){running2=false; setTimeout(endGame2,700); return;}
          continue;
        }
        occ2[e.lane]=false; eggs2.splice(i,1);
      } else { e.advance(); }
    }
  }
  function loop2(ts){
    if(!running2||paused2) return;
    const dt=Math.min(ts-lt2,200); lt2=ts;
    mt2+=dt; st2+=dt;
    if(st2>=spawnDelay2){st2=0;spawnEgg2();}
    if(mt2>=moveDelay2) {mt2=0;tickEggs2();}
    if(running2&&!paused2) frameId2=requestAnimationFrame(loop2);
  }

  // –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π Game
  window.Game = {
    start(m){
      mode=m; Score.reset(); Wolf.reset();
      document.getElementById('mode-display').textContent='–†–µ–∂–∏–º '+m;
      UI.showGame();
      setTimeout(()=>{
        layoutField(); calcSpeed2(); clearEggs2();
        running2=true; paused2=false;
        mt2=0; st2=spawnDelay2*0.4; lt2=performance.now();
        frameId2=requestAnimationFrame(loop2);
      },120);
    },
    restart(){
      document.getElementById('overlay-gameover').style.display='none';
      window.Game.start(mode);
    },
    pause(){
      if(!running2||paused2) return;
      paused2=true;
      if(frameId2){cancelAnimationFrame(frameId2);frameId2=null;}
      UI.showPause();
    },
    resume(){
      paused2=false; UI.hidePause();
      lt2=performance.now(); frameId2=requestAnimationFrame(loop2);
    },
    toMenu(){
      running2=false; paused2=false;
      if(frameId2){cancelAnimationFrame(frameId2);frameId2=null;}
      clearEggs2();
      document.getElementById('overlay-gameover').style.display='none';
      document.getElementById('overlay-pause').style.display='none';
      UI.showMenu();
    }
  };
})();
</script>

</body>
</html>
