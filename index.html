<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–í–æ–ª–∫ –ª–æ–≤–∏—Ç —è–π—Ü–∞ ‚Äî Pavel Game Studio</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%230066A1'/><text x='16' y='23' font-family='Arial' font-size='20' font-weight='bold' fill='%232FC7F7' text-anchor='middle'>P</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,700;0,800;0,900;1,400&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --lime:        #D4F01A;
  --lime-hover:  #BFDA10;
  --glass-nav:   rgba(255,255,255,0.18);
  --glass-card:  rgba(255,255,255,0.12);
  --glass-border:rgba(255,255,255,0.25);
  --text-white:  #FFFFFF;
  --text-dim:    rgba(255,255,255,0.7);
  --text-muted:  rgba(255,255,255,0.45);
  --error:       #FF3B5C;
  --black:       #292426;
}

/* ‚îÄ‚îÄ BASE ‚îÄ‚îÄ */
html { height: 100%; }
body {
  height: 100%;
  font-family: 'Inter', sans-serif;
  color: var(--text-white);
  user-select: none; -webkit-user-select: none;
  display: flex; flex-direction: column; align-items: center;
  overflow: hidden;
  background:
    radial-gradient(ellipse 100% 70% at 50% 0%,   #1e75ff 0%, transparent 70%),
    radial-gradient(ellipse 80%  60% at 100% 50%,  #0e4fd8 0%, transparent 65%),
    radial-gradient(ellipse 70%  50% at 0%   80%,  #0840c0 0%, transparent 60%),
    #1565FF;
  background-attachment: fixed;
}

/* ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ */
.logo {
  width: 100%; max-width: 560px;
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 14px;
  background: var(--glass-nav);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--glass-border);
  border-radius: 0 0 14px 14px;
  flex-shrink: 0; z-index: 10;
}
.logo-text {
  font-size: 1.25rem; font-weight: 800; color: var(--text-white);
  letter-spacing: -0.02em; display: flex; align-items: center; gap: 6px;
}
.logo-dot {
  display: inline-block; width: 7px; height: 7px;
  background: var(--lime); border-radius: 50%;
  animation: dotBlink 2s ease-in-out infinite;
}
@keyframes dotBlink {
  0%,100% { opacity:1; transform:scale(1); }
  50%     { opacity:0.5; transform:scale(0.75); }
}
.logo-badge {
  font-size: 0.6rem; font-weight: 800; color: var(--black);
  background: var(--lime); padding: 3px 9px; border-radius: 999px;
  letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer;
  transition: all 0.2s;
}
.logo-badge:hover { background: var(--lime-hover); transform: scale(1.04); }

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen {
  display: none; position: relative; z-index: 1;
  width: 100%; max-width: 560px;
  padding: 0 14px 16px;
  animation: fadeUp 0.4s cubic-bezier(0.22,1,0.36,1) both;
  /* Use available height after navbar */
  flex: 1; min-height: 0; overflow-y: auto;
}
.screen.active { display: flex; flex-direction: column; }
@keyframes fadeUp {
  from { opacity:0; transform:translateY(14px); }
  to   { opacity:1; transform:translateY(0); }
}

/* ‚îÄ‚îÄ MENU ‚îÄ‚îÄ */
.menu-hero { text-align: center; padding: 18px 0 14px; }
.menu-title {
  font-size: clamp(1.5rem, 6vw, 2.4rem); font-weight: 900;
  color: var(--text-white); line-height: 1.1; letter-spacing: -0.02em; margin-bottom: 6px;
}
.menu-subtitle {
  font-size: 0.9rem; font-weight: 400;
  color: var(--text-dim); margin-bottom: 18px; font-style: italic;
}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  display: block; width: 100%; border: none; border-radius: 999px;
  font-family: 'Inter', sans-serif; font-weight: 800; cursor: pointer;
  transition: all 0.2s ease; position: relative; overflow: hidden;
  letter-spacing: 0.04em; text-transform: uppercase;
}
.btn:active { transform: scale(0.95) !important; }

.btn-lime {
  padding: 14px 28px; font-size: 0.95rem; color: var(--black);
  background: var(--lime); box-shadow: 0 4px 24px rgba(212,240,26,0.35);
  margin-bottom: 10px;
}
.btn-lime:hover { background: var(--lime-hover); transform: scale(1.03); box-shadow: 0 8px 32px rgba(212,240,26,0.5); }

.btn-glass {
  padding: 12px 28px; font-size: 0.88rem; color: var(--text-white);
  background: var(--glass-card); border: 1.5px solid var(--glass-border);
  backdrop-filter: blur(12px); margin-bottom: 10px;
}
.btn-glass:hover { background: rgba(255,255,255,0.2); transform: scale(1.02); }

.btn-outline {
  padding: 11px 24px; font-size: 0.82rem; color: var(--text-white);
  background: transparent; border: 1.5px solid var(--glass-border); margin-bottom: 8px;
}
.btn-outline:hover { background: rgba(255,255,255,0.1); transform: scale(1.02); }

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card-glass {
  background: var(--glass-card); backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border);
  border-radius: 14px; padding: 14px 16px; margin-bottom: 10px;
}
.hs-card { text-align: center; }
.hs-label { font-size: 0.65rem; font-weight: 700; color: var(--text-muted); letter-spacing: 0.22em; text-transform: uppercase; margin-bottom: 4px; }
.hs-value { font-size: 2.4rem; font-weight: 900; color: var(--lime); line-height: 1; letter-spacing: -0.02em; text-shadow: 0 0 20px rgba(212,240,26,0.4); }

.ctrl-card h3 { font-size: 0.65rem; font-weight: 700; color: var(--text-muted); letter-spacing: 0.22em; text-transform: uppercase; margin-bottom: 12px; }
.ctrl-section { font-size: 0.68rem; color: var(--text-dim); font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; margin: 8px 0 6px; }
.ctrl-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 7px; margin-bottom: 4px; }
.ctrl-item { display: flex; align-items: center; gap: 9px; font-size: 0.8rem; color: var(--text-dim); font-weight: 500; }
.key {
  display: inline-flex; align-items: center; justify-content: center;
  width: 30px; height: 30px; background: rgba(255,255,255,0.15);
  border: 1.5px solid rgba(255,255,255,0.35); border-radius: 6px;
  font-size: 0.95rem; font-weight: 800; color: var(--text-white); flex-shrink: 0;
}
.ctrl-note { font-size: 0.72rem; color: var(--text-muted); margin-top: 5px; line-height: 1.65; }
.footer { text-align: center; color: var(--text-muted); font-size: 0.68rem; margin-top: 10px; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º flex-column,
   –ø–æ–ª–µ –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –º–µ—Å—Ç–æ
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#screen-game {
  padding: 0; max-width: 560px;
  /* –∫—Ä–∏—Ç–∏—á–Ω–æ: –∑–∞–ø—Ä–µ—â–∞–µ–º —Å–∫—Ä–æ–ª–ª –∏–≥—Ä–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ */
  overflow: hidden;
}

/* –•–µ–¥–µ—Ä */
.game-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 14px;
  background: var(--glass-nav); backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--glass-border);
  flex-shrink: 0;
}
.score-label { font-size: 0.52rem; font-weight: 700; color: var(--text-muted); letter-spacing: 0.22em; text-transform: uppercase; }
.score-value {
  font-size: 1.8rem; font-weight: 900; color: var(--lime); line-height: 1;
  letter-spacing: -0.02em; text-shadow: 0 0 14px rgba(212,240,26,0.4);
}
.score-value.bounce { animation: scoreBounce 0.28s ease; }
@keyframes scoreBounce { 0%{transform:scale(1)} 45%{transform:scale(1.3)} 100%{transform:scale(1)} }
.header-center { display: flex; align-items: center; gap: 7px; }
.mode-badge {
  font-size: 0.58rem; font-weight: 800; padding: 3px 9px; border-radius: 999px;
  background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3);
  color: var(--text-white); letter-spacing: 0.08em; text-transform: uppercase;
}
.sound-btn {
  background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.25);
  border-radius: 7px; color: var(--text-white); cursor: pointer;
  padding: 4px 8px; font-size: 0.9rem; transition: all 0.2s; line-height: 1;
}
.sound-btn:hover { background: rgba(255,255,255,0.25); }
.lives-block { display: flex; gap: 5px; align-items: center; }
.life-icon { font-size: 1.25rem; transition: all 0.3s ease; filter: drop-shadow(0 0 5px rgba(212,240,26,0.4)); }
.life-icon.lost { filter: grayscale(1) opacity(0.2); transform: scale(0.72); }

/* ‚îÄ‚îÄ GAME FIELD ‚îÄ‚îÄ */
#game-field {
  position: relative; width: 100%;
  background: linear-gradient(180deg, #1055e8 0%, #0e4fd8 60%, #0840c0 100%);
  overflow: hidden;
  border-left: 1px solid rgba(255,255,255,0.1);
  border-right: 1px solid rgba(255,255,255,0.1);
  /* flex-grow fills remaining space between header and controls */
  flex: 1; min-height: 0;
}

/* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –æ—Ä–± */
#game-field::before {
  content: ''; position: absolute;
  width: 220px; height: 220px; border-radius: 50%;
  left: 50%; top: 48%; transform: translate(-50%,-50%);
  background: radial-gradient(circle, rgba(47,199,247,0.14) 0%, transparent 70%);
  pointer-events: none; z-index: 0;
  animation: orb 6s ease-in-out infinite alternate;
}
@keyframes orb { 0%{transform:translate(-50%,-50%)scale(1);opacity:0.7} 100%{transform:translate(-50%,-50%)scale(1.12);opacity:1} }

.field-inner { position: relative; width: 100%; height: 100%; }

/* –ö—É—Ä–∏—Ü—ã */
.chicken {
  position: absolute; font-size: 1.7rem; z-index: 10;
  filter: drop-shadow(0 3px 8px rgba(0,0,0,0.35));
  transition: transform 0.15s;
}
.chicken.lay { animation: chickenLay 0.38s ease; }
@keyframes chickenLay {
  0%{transform:scale(1)rotate(0)} 35%{transform:scale(1.3)rotate(-16deg)}
  70%{transform:scale(1.1)rotate(8deg)} 100%{transform:scale(1)rotate(0)}
}

/* –ñ—ë–ª–æ–±–∞ ‚Äî –ø–ª–∞–≤–Ω—ã–µ, –Ω–µ –æ—Å—Ç—Ä—ã–µ */
.lane {
  position: absolute; transform-origin: 0 50%;
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.32);
  border-radius: 4px;
  box-shadow: 0 0 8px rgba(255,255,255,0.08);
}

/* –Ø–π—Ü–∞ */
.egg {
  position: absolute; font-size: 1.35rem; z-index: 20; pointer-events: none;
  transition: left 0.38s cubic-bezier(0.4,0,0.2,1), top 0.38s cubic-bezier(0.4,0,0.2,1);
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.3));
}
.egg.caught { animation: eggCaught 0.42s ease forwards; }
@keyframes eggCaught {
  0%  { transform:scale(1); opacity:1; }
  40% { transform:scale(1.8); filter:drop-shadow(0 0 18px rgba(212,240,26,0.95))brightness(2.5); }
  100%{ transform:scale(0); opacity:0; }
}
.egg.broken { animation: eggBroken 0.5s ease forwards; }
@keyframes eggBroken {
  0%  { transform:scale(1)rotate(0); opacity:1; }
  35% { transform:scale(1.4)rotate(22deg); filter:drop-shadow(0 0 16px rgba(255,59,92,0.9)); }
  100%{ transform:scale(0.4)rotate(50deg); opacity:0; }
}

/* ‚ïê‚ïê –í–û–õ–ö ¬´–ù–£, –ü–û–ì–û–î–ò¬ª ‚ïê‚ïê
   SVG-–ø–µ—Ä—Å–æ–Ω–∞–∂: —Å–µ—Ä—ã–π –≤–æ–ª–∫ –≤ –±–µ–ª–æ–π —Ä—É–±–∞—à–∫–µ
   —Å –∫–æ—Ä–∑–∏–Ω–æ–π. –†–∏—Å—É–µ–º inline —á–µ—Ä–µ–∑ data-uri.   */
#wolf {
  position: absolute; z-index: 30; pointer-events: none;
  transition: left 0.13s cubic-bezier(0.34,1.4,0.64,1), top 0.13s cubic-bezier(0.34,1.4,0.64,1);
  width: 52px; /* —à–∏—Ä–∏–Ω–∞ SVG */
}

/* Splat */
.splat {
  position: absolute; font-size: 1rem; z-index: 15; pointer-events: none;
  animation: splatAnim 0.9s ease forwards;
}
@keyframes splatAnim {
  0%  { transform:scale(0.4); opacity:1; }
  35% { transform:scale(1.5); opacity:1; }
  100%{ transform:scale(1.1); opacity:0; }
}

/* ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ */
.game-controls {
  display: flex; justify-content: space-between; align-items: center;
  padding: 8px 12px;
  background: var(--glass-nav); backdrop-filter: blur(20px);
  border-top: 1px solid var(--glass-border);
  gap: 6px; flex-shrink: 0;
}

.dpad { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }

.touch-btn {
  width: 56px; height: 50px;
  background: rgba(255,255,255,0.12);
  border: 1.5px solid rgba(255,255,255,0.25); border-radius: 11px;
  font-size: 1.25rem; cursor: pointer; transition: all 0.18s ease;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  color: var(--text-white); gap: 1px; backdrop-filter: blur(8px);
}
.touch-btn:active { transform: scale(0.84) !important; }
.touch-btn:hover { background: rgba(255,255,255,0.22); border-color: rgba(255,255,255,0.5); transform: scale(1.05); }
.touch-btn.active-pos {
  background: rgba(212,240,26,0.2); border-color: var(--lime);
  box-shadow: 0 0 16px rgba(212,240,26,0.5); filter: brightness(1.2);
}
.touch-btn-icon  { font-size: 1.2rem; line-height: 1; }
.touch-btn-label { font-size: 0.42rem; color: rgba(255,255,255,0.58); font-weight: 700; letter-spacing: 0.04em; }

.pause-btn {
  background: rgba(255,255,255,0.12); border: 1.5px solid rgba(255,255,255,0.25);
  border-radius: 11px; color: var(--text-white); cursor: pointer;
  padding: 0 10px; font-size: 1rem; transition: all 0.18s; height: 50px;
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1px;
  backdrop-filter: blur(8px);
}
.pause-btn:hover { background: rgba(255,255,255,0.22); }
.pause-btn-label { font-size: 0.42rem; color: rgba(255,255,255,0.45); font-weight: 700; letter-spacing: 0.05em; }

.kb-hint { display: flex; flex-direction: column; align-items: center; gap: 2px; }
.kb-row  { display: flex; gap: 2px; }
.kb-key {
  width: 23px; height: 23px; background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.28); border-radius: 4px;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.78rem; color: rgba(255,255,255,0.75); font-weight: 700;
}
.kb-hint-label { font-size: 0.44rem; color: rgba(255,255,255,0.38); margin-top: 2px; text-align: center; letter-spacing: 0.06em; font-weight: 700; }

/* ‚îÄ‚îÄ OVERLAYS ‚îÄ‚îÄ */
.overlay {
  position: fixed; inset: 0; z-index: 200;
  display: flex; align-items: center; justify-content: center;
  background: rgba(14,60,180,0.72);
  backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
  animation: fadeIn 0.25s ease;
}
@keyframes fadeIn { from{opacity:0} to{opacity:1} }

.modal {
  background: rgba(255,255,255,0.14);
  backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
  border: 1.5px solid rgba(255,255,255,0.3); border-radius: 22px;
  padding: 30px 28px; text-align: center; max-width: 340px; width: 90%;
  box-shadow: 0 24px 64px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.2);
  animation: modalPop 0.42s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes modalPop { from{transform:scale(0.8)translateY(16px);opacity:0} to{transform:scale(1)translateY(0);opacity:1} }

.modal-title-go   { font-size: 1.4rem; font-weight: 900; color: var(--text-white); margin-bottom: 6px; letter-spacing: -0.01em; }
.modal-title-pause{ font-size: 2rem; font-weight: 900; color: var(--text-white); margin-bottom: 22px; letter-spacing: -0.02em; }
.modal-score-label{ font-size: 0.62rem; font-weight: 700; color: var(--text-muted); letter-spacing: 0.22em; text-transform: uppercase; margin-bottom: 4px; }
.modal-score {
  font-size: 3.2rem; font-weight: 900; color: var(--lime);
  text-shadow: 0 0 24px rgba(212,240,26,0.5); letter-spacing: -0.03em; line-height: 1; margin-bottom: 8px;
  animation: countIn 0.5s cubic-bezier(0.34,1.4,0.64,1);
}
@keyframes countIn { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }
.modal-hs { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 20px; }
.new-record-badge {
  font-size: 0.82rem; font-weight: 800; color: var(--black); background: var(--lime);
  border-radius: 999px; padding: 4px 16px; margin-bottom: 12px; display: inline-block;
  text-transform: uppercase; letter-spacing: 0.06em;
  animation: recordPop 0.5s 0.2s both cubic-bezier(0.34,1.56,0.64,1), limePulse 1.5s 0.7s ease-in-out infinite alternate;
}
@keyframes recordPop { from{transform:scale(0);opacity:0} to{transform:scale(1);opacity:1} }
@keyframes limePulse { 0%{box-shadow:0 0 8px rgba(212,240,26,0.4)} 100%{box-shadow:0 0 22px rgba(212,240,26,0.85)} }

/* ‚îÄ‚îÄ –ê–ù–ò–ú–ê–¶–ò–ò ‚îÄ‚îÄ */
.shake { animation: shake 0.32s ease; }
@keyframes shake {
  0%,100%{transform:translateX(0)} 15%{transform:translateX(-8px)} 30%{transform:translateX(8px)}
  45%{transform:translateX(-5px)} 65%{transform:translateX(5px)} 82%{transform:translateX(-3px)}
}
.flash-red { animation: flashRed 0.42s ease; }
@keyframes flashRed {
  0%,100%{ box-shadow:none }
  50%{ box-shadow:inset 0 0 70px rgba(255,59,92,0.55), 0 0 40px rgba(255,59,92,0.2) }
}
.easter-msg {
  position: fixed; top: 38%; left: 50%; transform: translate(-50%,-50%);
  font-size: 1.7rem; font-weight: 900; color: var(--lime);
  text-shadow: 0 0 30px rgba(212,240,26,0.85); z-index: 300;
  animation: easterPop 2.1s ease forwards; pointer-events: none;
}
@keyframes easterPop {
  0%  { transform:translate(-50%,-50%)scale(0); opacity:0; }
  18% { transform:translate(-50%,-60%)scale(1.15); opacity:1; }
  72% { transform:translate(-50%,-60%)scale(1); opacity:1; }
  100%{ transform:translate(-50%,-80%)scale(0.8); opacity:0; }
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (hover:hover) and (pointer:fine) {
  .dpad { opacity:0.6; transition:opacity 0.2s; }
  .dpad:hover { opacity:1; }
}
@media (hover:none) and (pointer:coarse) {
  .kb-hint { display:none; }
  .dpad { opacity:1; }
}
/* –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã */
@media (max-height: 640px) {
  .game-header { padding: 5px 12px; }
  .score-value { font-size: 1.5rem; }
  .game-controls { padding: 5px 10px; }
  .touch-btn { width: 50px; height: 44px; font-size: 1.1rem; }
  .pause-btn { height: 44px; }
  .logo { padding: 5px 12px; }
  .logo-text { font-size: 1.1rem; }
}
@media (max-width: 380px) {
  .touch-btn { width: 48px; height: 44px; font-size: 1.1rem; }
  .logo-text { font-size: 1.05rem; }
}
</style>
</head>
<body>

<!-- NAVBAR -->
<div class="logo">
  <div class="logo-text">Pavel<span class="logo-dot"></span></div>
  <div class="logo-badge" onclick="typeof UI !== 'undefined' && UI.showMenu()">Game Studio</div>
</div>

<!-- ‚ïê‚ïê –ú–ï–ù–Æ ‚ïê‚ïê -->
<div id="screen-menu" class="screen active">
  <div class="menu-hero">
    <div class="menu-title">–í–æ–ª–∫ –ª–æ–≤–∏—Ç —è–π—Ü–∞</div>
    <div class="menu-subtitle">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∞—Ä–∫–∞–¥–∞ ¬∑ –ù—É, –ø–æ–≥–æ–¥–∏!</div>
  </div>

  <button class="btn btn-lime"  onclick="Game.start('A')">–ò–≥—Ä–∞ A ‚Äî –ù–æ—Ä–º–∞–ª—å–Ω–æ</button>
  <button class="btn btn-glass" onclick="Game.start('B')">–ò–≥—Ä–∞ B ‚Äî –°–ª–æ–∂–Ω–æ ‚ö°</button>

  <div class="card-glass hs-card">
    <div class="hs-label">üèÜ –†–µ–∫–æ—Ä–¥</div>
    <div class="hs-value" id="menu-highscore">000</div>
  </div>

  <div class="card-glass ctrl-card">
    <h3>‚å® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
    <div class="ctrl-section">üíª –ö–æ–º–ø—å—é—Ç–µ—Ä ‚Äî —Å—Ç—Ä–µ–ª–∫–∏</div>
    <div class="ctrl-grid">
      <div class="ctrl-item"><span class="key">‚Üê</span> –õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞</div>
      <div class="ctrl-item"><span class="key">‚Üí</span> –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞</div>
      <div class="ctrl-item"><span class="key">‚Üë</span> –í–µ—Ä—Ö–Ω–∏–π –∂—ë–ª–æ–±</div>
      <div class="ctrl-item"><span class="key">‚Üì</span> –ù–∏–∂–Ω–∏–π –∂—ë–ª–æ–±</div>
    </div>
    <div class="ctrl-note">‚Üê + ‚Üë = –ª–µ–≤–æ-–≤–µ—Ä—Ö ¬∑ ‚Üê + ‚Üì = –ª–µ–≤–æ-–Ω–∏–∑<br>‚Üí + ‚Üë = –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö ¬∑ ‚Üí + ‚Üì = –ø—Ä–∞–≤–æ-–Ω–∏–∑</div>
    <div class="ctrl-section" style="margin-top:12px;">üì± –ú–æ–±–∏–ª—å–Ω—ã–π ‚Äî –∫–Ω–æ–ø–∫–∏ ‚Üñ ‚Üô ‚Üó ‚Üò</div>
    <div class="ctrl-note">4 –∫–Ω–æ–ø–∫–∏ = 4 –ø–æ–∑–∏—Ü–∏–∏ –≤–æ–ª–∫–∞</div>
  </div>

  <div class="footer">¬© 2025 Pavel Game Studio</div>
</div>

<!-- ‚ïê‚ïê –ò–ì–†–ê ‚ïê‚ïê -->
<div id="screen-game" class="screen">

  <!-- –•–µ–¥–µ—Ä -->
  <div class="game-header">
    <div class="score-block">
      <div class="score-label">–°—á—ë—Ç</div>
      <div class="score-value" id="score-display">000</div>
    </div>
    <div class="header-center">
      <span class="mode-badge" id="mode-display">–†–µ–∂–∏–º A</span>
      <button class="sound-btn" id="sound-toggle" onclick="Sound.toggle()">üîä</button>
    </div>
    <div class="lives-block">
      <span class="life-icon" id="life-0">ü•ö</span>
      <span class="life-icon" id="life-1">ü•ö</span>
      <span class="life-icon" id="life-2">ü•ö</span>
    </div>
  </div>

  <!-- –ü–æ–ª–µ -->
  <div id="game-field">
    <div class="field-inner" id="field-inner">
      <div class="chicken" id="chicken-0">üêî</div>
      <div class="chicken" id="chicken-1">üêî</div>
      <div class="chicken" id="chicken-2">üêî</div>
      <div class="chicken" id="chicken-3">üêî</div>

      <!-- –í–æ–ª–∫ ¬´–ù—É, –ø–æ–≥–æ–¥–∏¬ª ‚Äî SVG –ø–µ—Ä—Å–æ–Ω–∞–∂ -->
      <div id="wolf">
        <svg width="52" height="68" viewBox="0 0 52 68" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- –¢–µ–ª–æ ‚Äî –±–µ–ª–∞—è —Ä—É–±–∞—à–∫–∞ -->
          <rect x="13" y="30" width="26" height="28" rx="5" fill="#FFFFFF"/>
          <!-- –ü–æ–ª–æ—Å—ã –Ω–∞ —Ä—É–±–∞—à–∫–µ ‚Äî —Å–µ—Ä—ã–µ -->
          <rect x="13" y="36" width="26" height="3" rx="1" fill="#D0D0D0"/>
          <rect x="13" y="43" width="26" height="3" rx="1" fill="#D0D0D0"/>
          <!-- –®—Ç–∞–Ω—ã ‚Äî —Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–µ -->
          <rect x="13" y="52" width="11" height="16" rx="3" fill="#1a3a8a"/>
          <rect x="28" y="52" width="11" height="16" rx="3" fill="#1a3a8a"/>
          <!-- –ù–æ–≥–∏ / –æ–±—É–≤—å ‚Äî —á—ë—Ä–Ω—ã–µ -->
          <rect x="11" y="62" width="14" height="6" rx="3" fill="#222"/>
          <rect x="27" y="62" width="14" height="6" rx="3" fill="#222"/>
          <!-- –®–µ—è -->
          <rect x="22" y="25" width="8" height="8" rx="2" fill="#8A8A8A"/>
          <!-- –ì–æ–ª–æ–≤–∞ ‚Äî —Å–µ—Ä–∞—è -->
          <ellipse cx="26" cy="18" rx="14" ry="13" fill="#8A8A8A"/>
          <!-- –ú–æ—Ä–¥–∞ (—Å–≤–µ—Ç–ª–µ–µ) -->
          <ellipse cx="26" cy="22" rx="8" ry="6" fill="#AFAFAF"/>
          <!-- –£—à–∏ -->
          <polygon points="12,8 8,0 18,6" fill="#8A8A8A"/>
          <polygon points="40,8 44,0 34,6" fill="#8A8A8A"/>
          <!-- –£—à–∏ –≤–Ω—É—Ç—Ä–∏ (—Ä–æ–∑–æ–≤—ã–µ) -->
          <polygon points="13,7 10,2 17,6" fill="#D08080"/>
          <polygon points="39,7 42,2 35,6" fill="#D08080"/>
          <!-- –ì–ª–∞–∑–∞ -->
          <ellipse cx="20" cy="16" rx="3.5" ry="3.5" fill="white"/>
          <ellipse cx="32" cy="16" rx="3.5" ry="3.5" fill="white"/>
          <circle cx="21" cy="16" r="2" fill="#222"/>
          <circle cx="33" cy="16" r="2" fill="#222"/>
          <!-- –ë–ª–µ—Å–∫ –≥–ª–∞–∑ -->
          <circle cx="22" cy="15" r="0.8" fill="white"/>
          <circle cx="34" cy="15" r="0.8" fill="white"/>
          <!-- –ù–æ—Å -->
          <ellipse cx="26" cy="22" rx="3" ry="2" fill="#555"/>
          <!-- –†–æ—Ç ‚Äî —É—Ö–º—ã–ª–∫–∞ -->
          <path d="M21 26 Q26 30 31 26" stroke="#555" stroke-width="1.5" stroke-linecap="round" fill="none"/>
          <!-- –°–∏–≥–∞—Ä–µ—Ç–∞ -->
          <rect x="30" y="25" width="12" height="3" rx="1.5" fill="#f5f5dc"/>
          <rect x="40" y="25" width="4" height="3" rx="1" fill="#FF6633"/>
          <!-- –î—ã–º–æ–∫ -->
          <path d="M42 24 Q44 20 42 17 Q40 14 42 11" stroke="rgba(255,255,255,0.5)" stroke-width="1.5" stroke-linecap="round" fill="none"/>
          <!-- –†—É–∫–∏ -->
          <rect x="2" y="32" width="13" height="7" rx="3.5" fill="#8A8A8A"/>
          <rect x="37" y="32" width="13" height="7" rx="3.5" fill="#8A8A8A"/>
          <!-- –ö–æ—Ä–∑–∏–Ω–∞ ‚Äî –ø—Ä–∞–≤–∞—è —Ä—É–∫–∞ –¥–µ—Ä–∂–∏—Ç -->
          <rect x="36" y="38" width="16" height="12" rx="3" fill="#C8A256"/>
          <rect x="36" y="38" width="16" height="3" rx="1" fill="#B8922A"/>
          <!-- –†—É—á–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã -->
          <path d="M40 38 Q44 32 48 38" stroke="#B8922A" stroke-width="2" fill="none" stroke-linecap="round"/>
          <!-- –ü–æ–ª–æ—Å–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã -->
          <line x1="40" y1="41" x2="40" y2="50" stroke="#B8922A" stroke-width="1"/>
          <line x1="44" y1="41" x2="44" y2="50" stroke="#B8922A" stroke-width="1"/>
          <line x1="48" y1="41" x2="48" y2="50" stroke="#B8922A" stroke-width="1"/>
        </svg>
      </div>

    </div>
  </div>

  <!-- –ù–∏–∂–Ω–µ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
  <div class="game-controls">
    <div class="dpad">
      <button class="touch-btn" id="btn-0"
        ontouchstart="Wolf.moveTo(0);return false;" onclick="Wolf.moveTo(0)">
        <span class="touch-btn-icon">‚Üñ</span>
        <span class="touch-btn-label">–õ–ï–í–û-–í–ï–†–•</span>
      </button>
      <button class="touch-btn" id="btn-2"
        ontouchstart="Wolf.moveTo(2);return false;" onclick="Wolf.moveTo(2)">
        <span class="touch-btn-icon">‚Üó</span>
        <span class="touch-btn-label">–ü–†–ê–í–û-–í–ï–†–•</span>
      </button>
      <button class="touch-btn" id="btn-1"
        ontouchstart="Wolf.moveTo(1);return false;" onclick="Wolf.moveTo(1)">
        <span class="touch-btn-icon">‚Üô</span>
        <span class="touch-btn-label">–õ–ï–í–û-–ù–ò–ó</span>
      </button>
      <button class="touch-btn" id="btn-3"
        ontouchstart="Wolf.moveTo(3);return false;" onclick="Wolf.moveTo(3)">
        <span class="touch-btn-icon">‚Üò</span>
        <span class="touch-btn-label">–ü–†–ê–í–û-–ù–ò–ó</span>
      </button>
    </div>

    <div style="display:flex;flex-direction:column;align-items:center;gap:5px;">
      <button class="pause-btn" onclick="Game.pause()">
        <span>‚è∏</span>
        <span class="pause-btn-label">ESC</span>
      </button>
      <div class="kb-hint">
        <div class="kb-row"><div class="kb-key">‚Üë</div></div>
        <div class="kb-row">
          <div class="kb-key">‚Üê</div>
          <div class="kb-key">‚Üì</div>
          <div class="kb-key">‚Üí</div>
        </div>
        <div class="kb-hint-label">–°–¢–†–ï–õ–ö–ò</div>
      </div>
    </div>

    <div style="display:flex;align-items:center;justify-content:center;width:128px;">
      <div style="font-size:0.55rem;color:rgba(255,255,255,0.35);line-height:2;text-align:left;">
        ‚Üê ‚Üë &nbsp;–ª–µ–≤–æ‚Äë–≤–µ—Ä—Ö<br>
        ‚Üê ‚Üì &nbsp;–ª–µ–≤–æ‚Äë–Ω–∏–∑<br>
        ‚Üí ‚Üë &nbsp;–ø—Ä–∞–≤–æ‚Äë–≤–µ—Ä—Ö<br>
        ‚Üí ‚Üì &nbsp;–ø—Ä–∞–≤–æ‚Äë–Ω–∏–∑
      </div>
    </div>
  </div>
</div>

<!-- –ü–ê–£–ó–ê -->
<div id="overlay-pause" class="overlay" style="display:none;">
  <div class="modal">
    <div class="modal-title-pause">‚è∏ –ü–ê–£–ó–ê</div>
    <button class="btn btn-lime"    style="margin-bottom:10px;" onclick="Game.resume()">‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    <button class="btn btn-outline" onclick="Game.toMenu()">üè† –í—ã—Ö–æ–¥ –≤ –º–µ–Ω—é</button>
  </div>
</div>

<!-- GAME OVER -->
<div id="overlay-gameover" class="overlay" style="display:none;">
  <div class="modal">
    <div class="modal-title-go">üíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</div>
    <div class="modal-score-label">–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç</div>
    <div class="modal-score" id="go-score">000</div>
    <div class="new-record-badge" id="go-newrecord" style="display:none">üåü –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!</div>
    <div class="modal-hs" id="go-highscore">–†–µ–∫–æ—Ä–¥: 000</div>
    <button class="btn btn-lime"    style="margin-bottom:10px;" onclick="Game.restart()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    <button class="btn btn-outline" onclick="Game.toMenu()">üè† –ú–µ–Ω—é</button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SOUND
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Sound = (() => {
  let ctx=null, on=true;
  function ac(){ if(!ctx) ctx=new(window.AudioContext||window.webkitAudioContext)(); return ctx; }
  function tone(freq,dur,type='sine',vol=0.28,delay=0){
    if(!on) return;
    try{
      const c=ac(),o=c.createOscillator(),g=c.createGain();
      o.connect(g); g.connect(c.destination);
      o.type=type; o.frequency.value=freq;
      const t=c.currentTime+delay;
      g.gain.setValueAtTime(vol,t);
      g.gain.exponentialRampToValueAtTime(0.001,t+dur);
      o.start(t); o.stop(t+dur+0.01);
    }catch(e){}
  }
  function noise(dur,vol=0.18){
    if(!on) return;
    try{
      const c=ac(),buf=c.createBuffer(1,c.sampleRate*dur,c.sampleRate);
      const d=buf.getChannelData(0);
      for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
      const s=c.createBufferSource(); s.buffer=buf;
      const g=c.createGain(); s.connect(g); g.connect(c.destination);
      g.gain.setValueAtTime(vol,c.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+dur);
      s.start();
    }catch(e){}
  }
  return {
    playCapture(){ tone(900,0.08,'sine',0.3); tone(1200,0.1,'sine',0.2,0.07); },
    playMiss()   { tone(220,0.32,'sawtooth',0.28); },
    playGameOver(){ tone(440,0.22,'sine',0.3,0); tone(330,0.22,'sine',0.3,0.25); tone(220,0.5,'sine',0.35,0.5); },
    playClick()  { noise(0.045,0.12); },
    playBonus()  { [523,659,784,1047].forEach((f,i)=>tone(f,0.14,'sine',0.22,i*0.11)); },
    toggle()     { on=!on; document.getElementById('sound-toggle').textContent=on?'üîä':'üîá'; }
  };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SCORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Score = (() => {
  let score=0,misses=0,lastBonus=0;
  let hs=parseInt(localStorage.getItem('wolfHS3')||'0');
  function rScore(){
    const el=document.getElementById('score-display');
    el.textContent=String(score).padStart(3,'0');
    el.classList.remove('bounce'); void el.offsetWidth; el.classList.add('bounce');
    setTimeout(()=>el.classList.remove('bounce'),300);
  }
  function rLives(){ for(let i=0;i<3;i++) document.getElementById('life-'+i).classList.toggle('lost',i>=(3-misses)); }
  return {
    reset(){ score=0;misses=0;lastBonus=0;rScore();rLives(); },
    add(){
      score=Math.min(score+1,999); rScore();
      const b=Math.floor(score/100);
      if(b>lastBonus){
        lastBonus=b;
        if(misses>0){misses--;rLives();}
        Sound.playBonus();
        const m={1:'üéâ –û—Ç–ª–∏—á–Ω–æ!',2:'üî• –ú–∞—Å—Ç–µ—Ä!',5:'üëë –õ–µ–≥–µ–Ω–¥–∞!'};
        if(m[b]) showEaster(m[b]);
      }
    },
    addMiss(){ misses++;rLives();return misses; },
    get score(){ return score; },
    get misses(){ return misses; },
    get hs(){ return hs; },
    saveHs(){ if(score>hs){hs=score;localStorage.setItem('wolfHS3',hs);return true;} return false; },
    updateMenuHs(){ document.getElementById('menu-highscore').textContent=String(hs).padStart(3,'0'); }
  };
})();

function showEaster(msg){
  const el=document.createElement('div');
  el.className='easter-msg'; el.textContent=msg;
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),2200);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const UI = {
  showMenu(){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById('screen-menu').classList.add('active');
    Score.updateMenuHs();
    document.getElementById('overlay-gameover').style.display='none';
    document.getElementById('overlay-pause').style.display='none';
  },
  showGame(){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById('screen-game').classList.add('active');
  },
  showPause()  { document.getElementById('overlay-pause').style.display='flex'; },
  hidePause()  { document.getElementById('overlay-pause').style.display='none'; },
  showGameOver(isNew){
    document.getElementById('go-score').textContent=String(Score.score).padStart(3,'0');
    document.getElementById('go-highscore').textContent='–†–µ–∫–æ—Ä–¥: '+String(Score.hs).padStart(3,'0');
    document.getElementById('go-newrecord').style.display=isNew?'inline-block':'none';
    document.getElementById('overlay-gameover').style.display='flex';
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GAME FIELD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const GF = {
  sz(){ const f=document.getElementById('game-field'); return {W:f.offsetWidth,H:f.offsetHeight}; },

  // –ñ—ë–ª–æ–±–∞ –º–µ–Ω–µ–µ –æ—Å—Ç—Ä—ã–µ: —è–π—Ü–∞ –∏–¥—É—Ç –Ω–µ –∫ –∫—Ä–∞—è–º,
  // –∞ –±–ª–∏–∂–µ –∫ —Ü–µ–Ω—Ç—Ä—É ‚Äî —É–≥–æ–ª –ø–æ–ª–æ–≥–∏–π
  eggPos(lane,step){
    const {W,H}=this.sz();
    // sx/sy ‚Äî —Å—Ç–∞—Ä—Ç (—É –∫—É—Ä–∏—Ü—ã), ex/ey ‚Äî –∫–æ–Ω–µ—Ü (—É –≤–æ–ª–∫–∞)
    // –°–¥–≤–∏–Ω—É–ª–∏ ex –±–ª–∏–∂–µ –∫ —Ü–µ–Ω—Ç—Ä—É, —á—Ç–æ–±—ã —É–≥–æ–ª –±—ã–ª –º–µ–Ω–µ–µ –æ—Å—Ç—Ä—ã–º
    const c=[
      {sx:W*.14,sy:H*.08,ex:W*.28,ey:H*.68}, // –ª–µ–≤–æ-–≤–µ—Ä—Ö
      {sx:W*.14,sy:H*.38,ex:W*.30,ey:H*.80}, // –ª–µ–≤–æ-–Ω–∏–∑
      {sx:W*.86,sy:H*.08,ex:W*.72,ey:H*.68}, // –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö
      {sx:W*.86,sy:H*.38,ex:W*.70,ey:H*.80}, // –ø—Ä–∞–≤–æ-–Ω–∏–∑
    ][lane];
    const t=step/3;
    return {x:c.sx+(c.ex-c.sx)*t-12, y:c.sy+(c.ey-c.sy)*t-12};
  },

  chickenPos(lane){
    const {W,H}=this.sz();
    return [
      {x:W*.04,y:H*.01},  // –ª–µ–≤–æ-–≤–µ—Ä—Ö
      {x:W*.04,y:H*.31},  // –ª–µ–≤–æ-–Ω–∏–∑
      {x:W*.82,y:H*.01},  // –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö
      {x:W*.82,y:H*.31},  // –ø—Ä–∞–≤–æ-–Ω–∏–∑
    ][lane];
  },

  wolfPos(pos){
    const {W,H}=this.sz();
    // –í–æ–ª–∫ —Å—Ç–æ–∏—Ç –≤ –Ω–∏–∂–Ω–µ–π —Ç—Ä–µ—Ç–∏, –±–ª–∏–∂–µ –∫ —Ü–µ–Ω—Ç—Ä—É
    return [
      {x:W*.18,y:H*.60}, // –ª–µ–≤–æ-–≤–µ—Ä—Ö
      {x:W*.18,y:H*.73}, // –ª–µ–≤–æ-–Ω–∏–∑
      {x:W*.60,y:H*.60}, // –ø—Ä–∞–≤–æ-–≤–µ—Ä—Ö
      {x:W*.60,y:H*.73}, // –ø—Ä–∞–≤–æ-–Ω–∏–∑
    ][pos];
  },

  laneSeg(lane){
    const {W,H}=this.sz();
    return [
      {sx:W*.17,sy:H*.10,ex:W*.30,ey:H*.66},
      {sx:W*.17,sy:H*.40,ex:W*.33,ey:H*.78},
      {sx:W*.83,sy:H*.10,ex:W*.70,ey:H*.66},
      {sx:W*.83,sy:H*.40,ex:W*.67,ey:H*.78},
    ][lane];
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WOLF
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Wolf = (() => {
  let pos=0;
  function place(){
    const p=GF.wolfPos(pos);
    const el=document.getElementById('wolf');
    el.style.left=p.x+'px'; el.style.top=p.y+'px';
  }
  function highlight(){
    for(let i=0;i<4;i++){
      const el=document.getElementById('btn-'+i);
      if(el) el.classList.toggle('active-pos',i===pos);
    }
  }
  return {
    get pos(){ return pos; },
    moveTo(p){ pos=p; place(); highlight(); Sound.playClick(); },
    render(){ place(); highlight(); },
    reset(){ pos=0; place(); highlight(); }
  };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EGG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
class Egg {
  constructor(lane){
    this.lane=lane; this.step=0; this.active=true;
    this.el=document.createElement('div');
    this.el.className='egg'; this.el.textContent='ü•ö';
    document.getElementById('field-inner').appendChild(this.el);
    this.render();
    const ch=document.getElementById('chicken-'+lane);
    if(ch){ ch.classList.add('lay'); setTimeout(()=>ch.classList.remove('lay'),400); }
  }
  render(){ const p=GF.eggPos(this.lane,this.step); this.el.style.left=p.x+'px'; this.el.style.top=p.y+'px'; }
  advance(){ this.step++; this.render(); }
  catch(){ this.active=false; this.el.classList.add('caught'); setTimeout(()=>this.el.remove(),450); }
  break(){
    this.active=false; this.el.classList.add('broken');
    const s=document.createElement('div'); s.className='splat'; s.textContent='üí•';
    const p=GF.eggPos(this.lane,this.step);
    s.style.left=p.x+'px'; s.style.top=p.y+'px';
    document.getElementById('field-inner').appendChild(s);
    setTimeout(()=>s.remove(),920); setTimeout(()=>this.el.remove(),560);
  }
  destroy(){ this.active=false; if(this.el.parentNode) this.el.remove(); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN GAME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Game = (() => {
  let mode='A',eggs=[],occ=[false,false,false,false];
  let running=false,paused=false,frameId=null;
  let moveDelay=500,spawnDelay=2000;
  let mt=0,st=0,lt=0;

  function calcSpeed(){
    const f=Math.pow(0.9,Math.floor(Score.score/50));
    moveDelay =Math.max(mode==='A'?200:150, Math.round((mode==='A'?500:380)*f));
    spawnDelay=Math.max(mode==='A'?600:400, Math.round((mode==='A'?2000:1400)*f));
  }
  function spawnEgg(){
    const free=[0,1,2,3].filter(i=>!occ[i]);
    if(!free.length) return;
    const lane=free[Math.floor(Math.random()*free.length)];
    occ[lane]=true; eggs.push(new Egg(lane));
  }
  function tickEggs(){
    for(let i=eggs.length-1;i>=0;i--){
      const e=eggs[i];
      if(!e.active){eggs.splice(i,1);continue;}
      if(e.step>=3){
        if(Wolf.pos===e.lane){
          e.catch(); Score.add(); Sound.playCapture(); calcSpeed();
        } else {
          e.break(); const m=Score.addMiss(); Sound.playMiss();
          const field=document.getElementById('game-field');
          field.classList.add('shake'); setTimeout(()=>field.classList.remove('shake'),340);
          field.classList.add('flash-red'); setTimeout(()=>field.classList.remove('flash-red'),420);
          occ[e.lane]=false; eggs.splice(i,1);
          if(m>=3){running=false; setTimeout(endGame,700); return;}
          continue;
        }
        occ[e.lane]=false; eggs.splice(i,1);
      } else { e.advance(); }
    }
  }
  function loop(ts){
    if(!running||paused) return;
    const dt=Math.min(ts-lt,200); lt=ts;
    mt+=dt; st+=dt;
    if(st>=spawnDelay){st=0;spawnEgg();}
    if(mt>=moveDelay) {mt=0;tickEggs();}
    if(running&&!paused) frameId=requestAnimationFrame(loop);
  }
  function clearEggs(){ eggs.forEach(e=>e.destroy()); eggs=[]; occ=[false,false,false,false]; }

  function layoutField(){
    // –ü–æ–ª–µ —Ç–µ–ø–µ—Ä—å flex:1, –≤—ã—Å–æ—Ç–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ CSS.
    // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
    for(let i=0;i<4;i++){
      const c=document.getElementById('chicken-'+i);
      const p=GF.chickenPos(i); c.style.left=p.x+'px'; c.style.top=p.y+'px';
    }
    document.querySelectorAll('.lane').forEach(l=>l.remove());
    for(let i=0;i<4;i++) drawLane(i);
    Wolf.render();
  }

  function drawLane(lane){
    const s=GF.laneSeg(lane);
    const dx=s.ex-s.sx,dy=s.ey-s.sy;
    const len=Math.sqrt(dx*dx+dy*dy),angle=Math.atan2(dy,dx)*180/Math.PI;
    const el=document.createElement('div'); el.className='lane';
    el.style.cssText=`width:${len}px;height:8px;left:${s.sx}px;top:${s.sy}px;transform:rotate(${angle}deg)`;
    document.getElementById('field-inner').appendChild(el);
  }

  function endGame(){
    if(frameId){cancelAnimationFrame(frameId);frameId=null;}
    clearEggs(); Sound.playGameOver();
    const isNew=Score.saveHs();
    setTimeout(()=>UI.showGameOver(isNew),450);
  }

  return {
    start(m){
      mode=m; Score.reset(); Wolf.reset();
      document.getElementById('mode-display').textContent='–†–µ–∂–∏–º '+m;
      UI.showGame();
      setTimeout(()=>{
        layoutField(); calcSpeed(); clearEggs();
        running=true; paused=false;
        mt=0; st=spawnDelay*0.4; lt=performance.now();
        frameId=requestAnimationFrame(loop);
      },120);
    },
    restart(){
      document.getElementById('overlay-gameover').style.display='none';
      Game.start(mode);
    },
    pause(){
      if(!running||paused) return;
      paused=true;
      if(frameId){cancelAnimationFrame(frameId);frameId=null;}
      UI.showPause();
    },
    resume(){
      paused=false; UI.hidePause();
      lt=performance.now(); frameId=requestAnimationFrame(loop);
    },
    toMenu(){
      running=false; paused=false;
      if(frameId){cancelAnimationFrame(frameId);frameId=null;}
      clearEggs();
      document.getElementById('overlay-gameover').style.display='none';
      document.getElementById('overlay-pause').style.display='none';
      UI.showMenu();
    }
  };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KEYBOARD ‚Äî —Å—Ç—Ä–µ–ª–∫–∏
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
{
  let axisLeft=true,axisTop=true;
  function calcPos(){
    if( axisLeft &&  axisTop) return 0;
    if( axisLeft && !axisTop) return 1;
    if(!axisLeft &&  axisTop) return 2;
    return 3;
  }
  function gameIsActive(){ return document.getElementById('screen-game').classList.contains('active'); }
  document.addEventListener('keydown',e=>{
    if(!gameIsActive()) return;
    switch(e.key){
      case 'ArrowLeft':  axisLeft=true;  Wolf.moveTo(calcPos()); e.preventDefault(); break;
      case 'ArrowRight': axisLeft=false; Wolf.moveTo(calcPos()); e.preventDefault(); break;
      case 'ArrowUp':    axisTop=true;   Wolf.moveTo(calcPos()); e.preventDefault(); break;
      case 'ArrowDown':  axisTop=false;  Wolf.moveTo(calcPos()); e.preventDefault(); break;
      case 'Escape': case ' ':
        if(document.getElementById('overlay-pause').style.display==='flex') Game.resume();
        else Game.pause();
        e.preventDefault(); break;
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RESIZE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('resize',()=>{
  if(!document.getElementById('screen-game').classList.contains('active')) return;
  // –ü–æ–ª–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è CSS flex, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏
  for(let i=0;i<4;i++){
    const c=document.getElementById('chicken-'+i);
    const p=GF.chickenPos(i); c.style.left=p.x+'px'; c.style.top=p.y+'px';
  }
  document.querySelectorAll('.lane').forEach(l=>l.remove());
  for(let i=0;i<4;i++){
    const s=GF.laneSeg(i);
    const dx=s.ex-s.sx,dy=s.ey-s.sy;
    const len=Math.sqrt(dx*dx+dy*dy),angle=Math.atan2(dy,dx)*180/Math.PI;
    const el=document.createElement('div'); el.className='lane';
    el.style.cssText=`width:${len}px;height:8px;left:${s.sx}px;top:${s.sy}px;transform:rotate(${angle}deg)`;
    document.getElementById('field-inner').appendChild(el);
  }
  Wolf.render();
});

Score.updateMenuHs();
</script>
</body>
</html>
